(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function Ke(n,e,t){let r=n[e];return r||(r=t(),n[e]=r),r}const m={none:0,left:1,up:2,right:4,down:8},oe={0:m.right|m.down,1:m.left|m.down|m.right,2:m.left|m.down,3:m.up,4:m.up|m.right|m.down,5:m.left|m.up|m.right|m.down,6:m.up|m.left|m.down,7:m.right,8:m.up|m.right,9:m.left|m.up|m.right,10:m.up|m.left,11:m.left,12:m.left|m.right,13:m.none,14:m.up|m.down,15:m.down},ht=Object.entries(oe).reduce((n,[e,t])=>{if(Ke(n,t,()=>parseInt(e))!=parseInt(e))throw new Error("failed to create tiling mapping: found a duplicate tiling rule: "+t.toString(2));return n},{}),Xe={left:{x:-1,y:0},up:{x:0,y:-1},right:{x:1,y:0},down:{x:0,y:1}};function ft(n,e){if(n==null)throw new Error(e);return n}const F=16,gt=3,Y=Object.freeze({w:4,h:4}),Ae="spritesheets",le=Y.w*Y.h,C=F*gt;function mt(n,e){return e*n.y+n.x}function ae(n,e){const t=Math.floor(n/e);return{x:n-e*t,y:t}}function pt(n,e,t){return Math.max(Math.min(n,t),e)}function _e(n,e){for(var t=1,r=n-e+1;r<=n;r++)t*=r;for(var r=1;r<=e;r++)t/=r;return t}function vt(n,e){var t=e.length-1,r=0,s=0;for(let i=0;i<=t;i++)s=s+_e(t,i)*Math.pow(1-n,t-i)*Math.pow(n,i)*e[i].x,r=r+_e(t,i)*Math.pow(1-n,t-i)*Math.pow(n,i)*e[i].y;return r}function Ve(n){let e=n.split(`
`);e=e.slice(1,e.length-1);const t=e.reduce((o,l)=>l.length>o?l.length:o,0),r=1/t,s=1/e.length,i=[];for(let o=0;o<t;o++){for(const[l,a]of e.entries()){const u=a[o];if(u!==void 0&&u!==" "){const c={x:o*r,y:(e.length-l)*s};i.push(c);continue}}[...e.entries()].find(([l,a])=>{const u=a[o];return u!==void 0&&u!==" "})}return function(o){return vt(o,i)}}function ne(n,e,t){return n>=e&&n<=t}class bt{constructor(e,t){this._canvas=e,this._ctx=t,this._sizeTiles=Object.freeze({w:Math.floor(e.clientWidth/C),h:Math.floor(e.clientHeight/C)}),this._sizePixels=Object.freeze({w:this.sizeTiles.w*C,h:this.sizeTiles.h*C}),e.width=this._sizePixels.w,e.height=this._sizePixels.h,e.classList.add("initialized")}get sizeTiles(){return this._sizeTiles}_sizeTiles;get sizePixelsPadded(){return this._sizePixels}_sizePixels;_grid={};_scheduledClearDurationMs=150;_clearScheduleAtTs=null;_sampleClearCurve=Ve(`
                                                                                        X       x
                                                                 
                                                X
                                        
                                
x             x
`);convertPxPositionToTilePos(e){return{x:Math.floor(e.x/C),y:Math.floor(e.y/C)}}convertTilePositionToTileGridIndex(e){return mt(e,this.sizeTiles.w)}convertTileGridIndexToTilePosition(e){return ae(e,this.sizeTiles.w)}get(e){const t=typeof e=="number"?e:this.convertTilePositionToTileGridIndex(e);return this._grid[t]}getCardinalNeighbors(e){const t={left:void 0,up:void 0,right:void 0,down:void 0};for(const[r,s]of Object.entries(Xe)){const i=r,o={x:e.x+s.x,y:e.y+s.y};this.isTilePositionWithinGrid(o)&&(t[i]=this.get(o))}return t}set(e,t){const r=typeof e=="number"?e:this.convertTilePositionToTileGridIndex(e),s=t;this.assertGridIndexWithinGrid(r),s===void 0?delete this._grid[r]:this._grid[r]=s}hasAt(e){const t=typeof e=="number"?e:this.convertTilePositionToTileGridIndex(e);return this.assertGridIndexWithinGrid(t),this._grid[t]!==void 0}draw(e){this._tryScheduledClearIfAny();const t=this._ctx;t.strokeStyle="hsl(0, 0%, 20%)";for(let o=0;o<=this.sizeTiles.w;o++){const l={x:C*o,y:0},a={x:C*o,y:this.sizePixelsPadded.h};t.beginPath(),t.moveTo(l.x,l.y),t.lineTo(a.x,a.y),t.stroke()}for(let o=0;o<=this.sizeTiles.h;o++){const l={x:0,y:C*o},a={x:this.sizePixelsPadded.w,y:C*o};t.beginPath(),t.moveTo(l.x,l.y),t.lineTo(a.x,a.y),t.stroke()}const r=this._isClearScheduled();let s=0,i=0;if(r){const o=this._getScheduledClearProgress();s=this._sampleClearCurve(o),i=C/2*s}for(let[o,l]of Object.entries(this._grid)){if(l===void 0)continue;const a=parseInt(o),u=this.convertTileGridIndexToTilePosition(a),c={x:u.x*C,y:u.y*C},d=l.ss.calculateSpritesheetTileRegion(l.tiling);t.save(),t.translate(c.x,c.y),r&&(t.translate(i,i),t.scale(1-s,1-s)),t.drawImage(l.ss.image,d.x,d.y,d.w,d.h,0,0,C,C),t.restore()}}clear(){this._isClearScheduled()||(this._clearScheduleAtTs=Date.now()+this._scheduledClearDurationMs)}_tryScheduledClearIfAny(){this._isClearScheduled()&&this._clearScheduleAtTs<=Date.now()&&(this._grid={},this._clearScheduleAtTs=null)}_getScheduledClearProgress(){if(!this._isClearScheduled())return 0;const t=1-(this._clearScheduleAtTs-Date.now())/this._scheduledClearDurationMs;return pt(t,0,1)}_isClearScheduled(){return this._clearScheduleAtTs!==null}isTilePositionWithinGrid(e){return ne(e.x,0,this.sizeTiles.w-1)&&ne(e.y,0,this.sizeTiles.h-1)}isGridIndexWithinGrid(e){return ne(e,0,this.sizeTiles.w*this.sizeTiles.h)}assertTilePositionWithinGrid(e){if(!this.isTilePositionWithinGrid(e))throw new Error("failed assert assertIsTilePositionWithinGrid: "+e)}assertGridIndexWithinGrid(e){if(!this.isGridIndexWithinGrid(e))throw new Error("failed assert assertGridIndexWithinGrid: "+e)}}function Tt(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var re={exports:{}},We;function yt(){return We||(We=1,function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function s(a,u,c){this.fn=a,this.context=u,this.once=c||!1}function i(a,u,c,d,v){if(typeof c!="function")throw new TypeError("The listener must be a function");var f=new s(c,d||a,v),g=t?t+u:u;return a._events[g]?a._events[g].fn?a._events[g]=[a._events[g],f]:a._events[g].push(f):(a._events[g]=f,a._eventsCount++),a}function o(a,u){--a._eventsCount===0?a._events=new r:delete a._events[u]}function l(){this._events=new r,this._eventsCount=0}l.prototype.eventNames=function(){var u=[],c,d;if(this._eventsCount===0)return u;for(d in c=this._events)e.call(c,d)&&u.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},l.prototype.listeners=function(u){var c=t?t+u:u,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var v=0,f=d.length,g=new Array(f);v<f;v++)g[v]=d[v].fn;return g},l.prototype.listenerCount=function(u){var c=t?t+u:u,d=this._events[c];return d?d.fn?1:d.length:0},l.prototype.emit=function(u,c,d,v,f,g){var w=t?t+u:u;if(!this._events[w])return!1;var h=this._events[w],S=arguments.length,y,p;if(h.fn){switch(h.once&&this.removeListener(u,h.fn,void 0,!0),S){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,c),!0;case 3:return h.fn.call(h.context,c,d),!0;case 4:return h.fn.call(h.context,c,d,v),!0;case 5:return h.fn.call(h.context,c,d,v,f),!0;case 6:return h.fn.call(h.context,c,d,v,f,g),!0}for(p=1,y=new Array(S-1);p<S;p++)y[p-1]=arguments[p];h.fn.apply(h.context,y)}else{var B=h.length,x;for(p=0;p<B;p++)switch(h[p].once&&this.removeListener(u,h[p].fn,void 0,!0),S){case 1:h[p].fn.call(h[p].context);break;case 2:h[p].fn.call(h[p].context,c);break;case 3:h[p].fn.call(h[p].context,c,d);break;case 4:h[p].fn.call(h[p].context,c,d,v);break;default:if(!y)for(x=1,y=new Array(S-1);x<S;x++)y[x-1]=arguments[x];h[p].fn.apply(h[p].context,y)}}return!0},l.prototype.on=function(u,c,d){return i(this,u,c,d,!1)},l.prototype.once=function(u,c,d){return i(this,u,c,d,!0)},l.prototype.removeListener=function(u,c,d,v){var f=t?t+u:u;if(!this._events[f])return this;if(!c)return o(this,f),this;var g=this._events[f];if(g.fn)g.fn===c&&(!v||g.once)&&(!d||g.context===d)&&o(this,f);else{for(var w=0,h=[],S=g.length;w<S;w++)(g[w].fn!==c||v&&!g[w].once||d&&g[w].context!==d)&&h.push(g[w]);h.length?this._events[f]=h.length===1?h[0]:h:o(this,f)}return this},l.prototype.removeAllListeners=function(u){var c;return u?(c=t?t+u:u,this._events[c]&&o(this,c)):(this._events=new r,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=t,l.EventEmitter=l,n.exports=l}(re)),re.exports}var wt=yt();const Je=Tt(wt),_=new Je,Qe="gui-built";function St(){_.emit(Qe)}const Ze="initial-spritesheet-set";function Ct(n){_.emit(Ze,n)}const et="spritesheets-loaded";function xt(n){_.emit(et,n)}const tt="tileset-changed";function nt(n){_.emit(tt,n)}function Ee(n){_.addListener(tt,n)}const rt="tile-selection-window-toggled";function It(n,e){_.emit(rt,n,e)}function Pt(n){_.addListener(rt,n)}class At{constructor(e,t){this._grid=e,this._tileset=t}get tileset(){return this._tileset}mode="brush";setTileset(e){this._tileset=e,nt(e)}setMode(e){this.mode=e}tryApplyAt(e){if(!this._grid.isTilePositionWithinGrid(e))return;const t=this._grid.getCardinalNeighbors(e);switch(this.mode){case"brush":this.applyBrushMode(e,t);break;case"eraser":this.applyEraserMode(e);break;default:throw new Error("not impl brush mode: "+this.mode)}for(const[r,s]of Object.entries(t)){const i=r;if(s===void 0)continue;const o=Xe[i],l={x:e.x+o.x,y:e.y+o.y},a=this._grid.getCardinalNeighbors(l),u=this._tileset.convertCardinalNeighborsToTiling(a);this._grid.set(l,{ss:s.ss,tiling:u})}}applyBrushMode(e,t){const r=this._tileset.convertCardinalNeighborsToTiling(t);this._grid.set(e,{ss:this.tileset,tiling:r})}applyEraserMode(e){this._grid.hasAt(e)&&this._grid.set(e,void 0)}}const st=[{ssName:"Core_ItmSealTemp01Sheet",relPath:"ItmSealTemp01Sheet.png"},{ssName:"Core_ItmWallBlueCaution01Sheet",relPath:"ItmWallBlueCaution01Sheet.png"},{ssName:"Core_ItmWallGrayBevel01Sheet",relPath:"ItmWallGrayBevel01Sheet.png"},{ssName:"Core_ItmWallGrayCaution01Sheet",relPath:"ItmWallGrayCaution01Sheet.png"},{ssName:"Core_ItmWallGrayPanel01Sheet",relPath:"ItmWallGrayPanel01Sheet.png"},{ssName:"Core_ItmWallGreenCross01Sheet",relPath:"ItmWallGreenCross01Sheet.png"},{ssName:"Core_ItmWallGreenRing01Sheet",relPath:"ItmWallGreenRing01Sheet.png"},{ssName:"Core_ItmWallMetalBSheet",relPath:"ItmWallMetalBSheet.png"},{ssName:"Core_ItmWallPanelWSheet",relPath:"ItmWallPanelWSheet.png"},{ssName:"Core_ItmWallPurpleCross01Sheet",relPath:"ItmWallPurpleCross01Sheet.png"},{ssName:"Core_ItmWallRedBand01Sheet",relPath:"ItmWallRedBand01Sheet.png"},{ssName:"Core_ItmWallRedCross01Sheet",relPath:"ItmWallRedCross01Sheet.png"},{ssName:"Core_ItmWallTanOrange01Sheet",relPath:"ItmWallTanOrange01Sheet.png"},{ssName:"Core_ItmWallThin1x1BlueSheet",relPath:"ItmWallThin1x1BlueSheet.png"},{ssName:"Core_ItmWallThin1x1GrayCautionSheet",relPath:"ItmWallThin1x1GrayCautionSheet.png"},{ssName:"Core_ItmWallThin1x1GrayCautionSheet02",relPath:"ItmWallThin1x1GrayCautionSheet02.png"},{ssName:"Core_ItmWallThin1x1GraySheet",relPath:"ItmWallThin1x1GraySheet.png"},{ssName:"Core_ItmWallThin1x1GreenSheet",relPath:"ItmWallThin1x1GreenSheet.png"},{ssName:"Core_ItmWallThin1x1OrangeSheet",relPath:"ItmWallThin1x1OrangeSheet.png"},{ssName:"Core_ItmWallThin1x1RedSheet",relPath:"ItmWallThin1x1RedSheet.png"},{ssName:"Core_ItmWallThin1x1YellowSheet",relPath:"ItmWallThin1x1YellowSheet.png"},{ssName:"Core_ItmWallWhiteCross01Sheet",relPath:"ItmWallWhiteCross01Sheet.png"},{ssName:"Core_ItmWallWindowSheet",relPath:"ItmWallWindowSheet.png"},{ssName:"Core_ItmWallWindowSheetSq",relPath:"ItmWallWindowSheetSq.png"},{ssName:"Core_ItmWallYellowCaution01Sheet",relPath:"ItmWallYellowCaution01Sheet.png"},{ssName:"Core_ItmWallAeroSheet",relPath:"AeroParts/ItmWallAeroSheet.png"},{ssName:"Core_ItmWallAeroSheetSq",relPath:"AeroParts/ItmWallAeroSheetSq.png"},{ssName:"Core_ItmWallAeroExtWhite01Sheet",relPath:"ItmFloorGrate12A/ItmWallAeroExtWhite01Sheet.png"},{ssName:"Core_ItmWallAeroInt01Sheet",relPath:"ItmFloorGrate12A/ItmWallAeroInt01Sheet.png"},{ssName:"Core_ItmWallAeroInt02Sheet",relPath:"ItmFloorGrate12A/ItmWallAeroInt02Sheet.png"},{ssName:"Core_ItmWallAeroInt03Sheet",relPath:"ItmFloorGrate12A/ItmWallAeroInt03Sheet.png"},{ssName:"Core_ItmWallAeroInt04Sheet",relPath:"ItmFloorGrate12A/ItmWallAeroInt04Sheet.png"},{ssName:"Core_ItmMeat01EyeSheet",relPath:"Meat01/ItmMeat01EyeSheet.png"},{ssName:"Core_ItmMeat01HoofSheet",relPath:"Meat01/ItmMeat01HoofSheet.png"},{ssName:"Core_ItmMeat01HornSheet",relPath:"Meat01/ItmMeat01HornSheet.png"},{ssName:"Core_ItmMeat01Sheet",relPath:"Meat01/ItmMeat01Sheet.png"}];function I(n){if(typeof n!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(n))}function Be(n,e){for(var t="",r=0,s=-1,i=0,o,l=0;l<=n.length;++l){if(l<n.length)o=n.charCodeAt(l);else{if(o===47)break;o=47}if(o===47){if(!(s===l-1||i===1))if(s!==l-1&&i===2){if(t.length<2||r!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){var a=t.lastIndexOf("/");if(a!==t.length-1){a===-1?(t="",r=0):(t=t.slice(0,a),r=t.length-1-t.lastIndexOf("/")),s=l,i=0;continue}}else if(t.length===2||t.length===1){t="",r=0,s=l,i=0;continue}}e&&(t.length>0?t+="/..":t="..",r=2)}else t.length>0?t+="/"+n.slice(s+1,l):t=n.slice(s+1,l),r=l-s-1;s=l,i=0}else o===46&&i!==-1?++i:i=-1}return t}function _t(n,e){var t=e.dir||e.root,r=e.base||(e.name||"")+(e.ext||"");return t?t===e.root?t+r:t+n+r:r}var P={process_cwd:"",setCWD:function(e){P.process_cwd=e},resolve:function(){for(var e="",t=!1,r,s=arguments.length-1;s>=-1&&!t;s--){var i;s>=0?i=arguments[s]:(r===void 0&&(r=P.process_cwd),i=r),I(i),i.length!==0&&i+"/"!==e&&(e=i+"/"+e,t=i.charCodeAt(0)===47)}return e=Be(e,!t),t?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(I(e),e.length===0)return".";var t=e.charCodeAt(0)===47,r=e.charCodeAt(e.length-1)===47;return e=Be(e,!t),e.length===0&&!t&&(e="."),e.length>0&&r&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return I(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,t=0;t<arguments.length;++t){var r=arguments[t];I(r),r.length>0&&(e===void 0?e=r:e+="/"+r)}return e===void 0?".":P.normalize(e)},relative:function(e,t){if(I(e),I(t),e===t)return"";const r=e.replaceAll("\\","/"),s=t.replaceAll("\\","/");if(r!=e&&s!=t)return P.relative(r,s).replaceAll("/","\\");if(r!=e)return P.relative(r,t).replaceAll("/","\\");if(s!=t)return P.relative(e,s);if(e=P.resolve(e),t=P.resolve(t),e===t)return"";for(var i=1;i<e.length&&e.charCodeAt(i)===47;++i);for(var o=e.length,l=o-i,a=1;a<t.length&&t.charCodeAt(a)===47;++a);for(var u=t.length,c=u-a,d=l<c?l:c,v=-1,f=0;f<=d;++f){if(f===d){if(c>d){if(t.charCodeAt(a+f)===47)return t.slice(a+f+1);if(f===0)return t.slice(a+f)}else l>d&&(e.charCodeAt(i+f)===47?v=f:f===0&&(v=0));break}var g=e.charCodeAt(i+f),w=t.charCodeAt(a+f);if(g!==w)break;g===47&&(v=f)}var h="";for(f=i+v+1;f<=o;++f)(f===o||e.charCodeAt(f)===47)&&(h.length===0?h+="..":h+="/..");return h.length>0?h+t.slice(a+v):(a+=v,t.charCodeAt(a)===47&&++a,t.slice(a))},_makeLong:function(e){return e},dirname:function(e){if(I(e),e.length===0)return".";for(var t=e.charCodeAt(0),r=t===47,s=-1,i=!0,o=e.length-1;o>=1;--o)if(t=e.charCodeAt(o),t===47){if(!i){s=o;break}}else i=!1;return s===-1?r?"/":".":r&&s===1?"//":e.slice(0,s)},basename:function(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');I(e);var r=0,s=-1,i=!0,o;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var l=t.length-1,a=-1;for(o=e.length-1;o>=0;--o){var u=e.charCodeAt(o);if(u===47){if(!i){r=o+1;break}}else a===-1&&(i=!1,a=o+1),l>=0&&(u===t.charCodeAt(l)?--l===-1&&(s=o):(l=-1,s=a))}return r===s?s=a:s===-1&&(s=e.length),e.slice(r,s)}else{for(o=e.length-1;o>=0;--o)if(e.charCodeAt(o)===47){if(!i){r=o+1;break}}else s===-1&&(i=!1,s=o+1);return s===-1?"":e.slice(r,s)}},extname:function(e){I(e);for(var t=-1,r=0,s=-1,i=!0,o=0,l=e.length-1;l>=0;--l){var a=e.charCodeAt(l);if(a===47){if(!i){r=l+1;break}continue}s===-1&&(i=!1,s=l+1),a===46?t===-1?t=l:o!==1&&(o=1):t!==-1&&(o=-1)}return t===-1||s===-1||o===0||o===1&&t===s-1&&t===r+1?"":e.slice(t,s)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return _t("/",e)},parse:function(e){I(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;var r=e.charCodeAt(0),s=r===47,i;s?(t.root="/",i=1):i=0;for(var o=-1,l=0,a=-1,u=!0,c=e.length-1,d=0;c>=i;--c){if(r=e.charCodeAt(c),r===47){if(!u){l=c+1;break}continue}a===-1&&(u=!1,a=c+1),r===46?o===-1?o=c:d!==1&&(d=1):o!==-1&&(d=-1)}return o===-1||a===-1||d===0||d===1&&o===a-1&&o===l+1?a!==-1&&(l===0&&s?t.base=t.name=e.slice(1,a):t.base=t.name=e.slice(l,a)):(l===0&&s?(t.name=e.slice(1,o),t.base=e.slice(1,a)):(t.name=e.slice(l,o),t.base=e.slice(l,a)),t.ext=e.slice(o,a)),l>0?t.dir=e.slice(0,l-1):s&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};P.posix=P;async function Wt(n){await new Promise(e=>setTimeout(e,n))}const se=10,ke=(n=0)=>e=>`\x1B[${e+n}m`,Ne=(n=0)=>e=>`\x1B[${38+n};5;${e}m`,Le=(n=0)=>(e,t,r)=>`\x1B[${38+n};2;${e};${t};${r}m`,b={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],gray:[90,39],grey:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgGray:[100,49],bgGrey:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};Object.keys(b.modifier);const Et=Object.keys(b.color),Bt=Object.keys(b.bgColor);[...Et,...Bt];function kt(){const n=new Map;for(const[e,t]of Object.entries(b)){for(const[r,s]of Object.entries(t))b[r]={open:`\x1B[${s[0]}m`,close:`\x1B[${s[1]}m`},t[r]=b[r],n.set(s[0],s[1]);Object.defineProperty(b,e,{value:t,enumerable:!1})}return Object.defineProperty(b,"codes",{value:n,enumerable:!1}),b.color.close="\x1B[39m",b.bgColor.close="\x1B[49m",b.color.ansi=ke(),b.color.ansi256=Ne(),b.color.ansi16m=Le(),b.bgColor.ansi=ke(se),b.bgColor.ansi256=Ne(se),b.bgColor.ansi16m=Le(se),Object.defineProperties(b,{rgbToAnsi256:{value(e,t,r){return e===t&&t===r?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(t/255*5)+Math.round(r/255*5)},enumerable:!1},hexToRgb:{value(e){const t=/[a-f\d]{6}|[a-f\d]{3}/i.exec(e.toString(16));if(!t)return[0,0,0];let[r]=t;r.length===3&&(r=[...r].map(i=>i+i).join(""));const s=Number.parseInt(r,16);return[s>>16&255,s>>8&255,s&255]},enumerable:!1},hexToAnsi256:{value:e=>b.rgbToAnsi256(...b.hexToRgb(e)),enumerable:!1},ansi256ToAnsi:{value(e){if(e<8)return 30+e;if(e<16)return 90+(e-8);let t,r,s;if(e>=232)t=((e-232)*10+8)/255,r=t,s=t;else{e-=16;const l=e%36;t=Math.floor(e/36)/5,r=Math.floor(l/6)/5,s=l%6/5}const i=Math.max(t,r,s)*2;if(i===0)return 30;let o=30+(Math.round(s)<<2|Math.round(r)<<1|Math.round(t));return i===2&&(o+=60),o},enumerable:!1},rgbToAnsi:{value:(e,t,r)=>b.ansi256ToAnsi(b.rgbToAnsi256(e,t,r)),enumerable:!1},hexToAnsi:{value:e=>b.ansi256ToAnsi(b.hexToAnsi256(e)),enumerable:!1}}),b}const A=kt(),Me=(()=>{if(!("navigator"in globalThis))return 0;if(globalThis.navigator.userAgentData){const n=navigator.userAgentData.brands.find(({brand:e})=>e==="Chromium");if(n&&n.version>93)return 3}return/\b(Chrome|Chromium)\//.test(globalThis.navigator.userAgent)?1:0})(),Oe=Me!==0&&{level:Me},Nt={stdout:Oe,stderr:Oe};function Lt(n,e,t){let r=n.indexOf(e);if(r===-1)return n;const s=e.length;let i=0,o="";do o+=n.slice(i,r)+e+t,i=r+s,r=n.indexOf(e,i);while(r!==-1);return o+=n.slice(i),o}function Mt(n,e,t,r){let s=0,i="";do{const o=n[r-1]==="\r";i+=n.slice(s,o?r-1:r)+e+(o?`\r
`:`
`)+t,s=r+1,r=n.indexOf(`
`,s)}while(r!==-1);return i+=n.slice(s),i}const{stdout:Ge,stderr:Re}=Nt,ce=Symbol("GENERATOR"),O=Symbol("STYLER"),$=Symbol("IS_EMPTY"),Fe=["ansi","ansi","ansi256","ansi16m"],G=Object.create(null),Ot=(n,e={})=>{if(e.level&&!(Number.isInteger(e.level)&&e.level>=0&&e.level<=3))throw new Error("The `level` option should be an integer from 0 to 3");const t=Ge?Ge.level:0;n.level=e.level===void 0?t:e.level},Gt=n=>{const e=(...t)=>t.join(" ");return Ot(e,n),Object.setPrototypeOf(e,U.prototype),e};function U(n){return Gt(n)}Object.setPrototypeOf(U.prototype,Function.prototype);for(const[n,e]of Object.entries(A))G[n]={get(){const t=K(this,de(e.open,e.close,this[O]),this[$]);return Object.defineProperty(this,n,{value:t}),t}};G.visible={get(){const n=K(this,this[O],!0);return Object.defineProperty(this,"visible",{value:n}),n}};const ue=(n,e,t,...r)=>n==="rgb"?e==="ansi16m"?A[t].ansi16m(...r):e==="ansi256"?A[t].ansi256(A.rgbToAnsi256(...r)):A[t].ansi(A.rgbToAnsi(...r)):n==="hex"?ue("rgb",e,t,...A.hexToRgb(...r)):A[t][n](...r),Rt=["rgb","hex","ansi256"];for(const n of Rt){G[n]={get(){const{level:t}=this;return function(...r){const s=de(ue(n,Fe[t],"color",...r),A.color.close,this[O]);return K(this,s,this[$])}}};const e="bg"+n[0].toUpperCase()+n.slice(1);G[e]={get(){const{level:t}=this;return function(...r){const s=de(ue(n,Fe[t],"bgColor",...r),A.bgColor.close,this[O]);return K(this,s,this[$])}}}}const Ft=Object.defineProperties(()=>{},{...G,level:{enumerable:!0,get(){return this[ce].level},set(n){this[ce].level=n}}}),de=(n,e,t)=>{let r,s;return t===void 0?(r=n,s=e):(r=t.openAll+n,s=e+t.closeAll),{open:n,close:e,openAll:r,closeAll:s,parent:t}},K=(n,e,t)=>{const r=(...s)=>Dt(r,s.length===1?""+s[0]:s.join(" "));return Object.setPrototypeOf(r,Ft),r[ce]=n,r[O]=e,r[$]=t,r},Dt=(n,e)=>{if(n.level<=0||!e)return n[$]?"":e;let t=n[O];if(t===void 0)return e;const{openAll:r,closeAll:s}=t;if(e.includes("\x1B"))for(;t!==void 0;)e=Lt(e,t.close,t.open),t=t.parent;const i=e.indexOf(`
`);return i!==-1&&(e=Mt(e,s,r,i)),r+e+s};Object.defineProperties(U.prototype,G);const D=U();U({level:Re?Re.level:0});const he={DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},zt={DEBUG:n=>D.gray(n),INFO:n=>n,WARN:n=>D.yellow(n),ERROR:n=>D.red(n),FATAL:n=>D.bgRed(n)};let fe="INFO",De=he[fe];const $t={};class jt{logPrefix="";constructor(e){this.logPrefix=e}static setLogLevel(e){fe=e,De=he[fe]}setLogPrefix=e=>{this.logPrefix=e};log=(e,t,...r)=>{if(he[e]<De)return;const s=typeof t=="object",i=s?t.msg:t,o=s?t:$t;let l;e==="DEBUG"||e==="INFO"?l=console.log:e==="WARN"?l=console.warn:e==="ERROR"||e==="FATAL"?l=console.error:l=console.log;const a=zt[e],u=i.split(`
`);for(let c=0;c<u.length;c++)l(a(`${D.bold(e.toLowerCase())}: [${this.logPrefix}] ${u[c]}`));if(r.length>0&&l(...r),o.data!==void 0&&(o.stringifyData?l(JSON.stringify(o.data,null,4)):l(o.data)),o.throw)throw new Error("see previous message")};logDebug=(e,...t)=>{this.log("DEBUG",e,...t)};logInfo=(e,...t)=>{this.log("INFO",e,...t)};logWarn=(e,...t)=>{this.log("WARN",e,...t)};logError=(e,...t)=>{this.log("ERROR",e,...t)};logFatal=(e,...t)=>{this.log("FATAL",e,...t)}}function q(n,e){return Array.isArray(n)?(e=n[1],n=n[0]):e===void 0&&(e=n,n=0),n+Math.random()*(e-n)}function Ut(...n){return Math.round(q.apply(null,n))}function qt(n){return n.length>0?Ut(n.length-1):-1}function Ht(n){return n[qt(n)]}const Yt=new jt("lib/spritesheets"),{logFatal:Kt}=Yt,ze=st;class J{constructor(e,t,r){this._name=e,this._image=t,this._imageUrl=r}get name(){return this._name}get image(){return this._image}get imageUrl(){return this._imageUrl}isEqual(e){return this.imageUrl===e.imageUrl}static async loadRandomCoreTileset(){const e=Ht(ze),t=`${Ae}/${e.relPath}`;return await this.loadTileset(t,e.ssName)}static async loadCoreTilesets(){const e=[];for(const t of ze){const r=`${Ae}/${t.relPath}`,s=this.loadTileset(r,t.ssName);e.push(s),await Wt(25)}return await Promise.all(e)}static async loadTileset(e,t){return await fetch(e).then(r=>r.blob()).then(createImageBitmap).then(r=>new J(t,r,e)).catch(r=>{throw Kt({msg:"error while loading a spritesheet",throw:!0,data:{url:e,name:t,error:r}}),""})}convertSsIndexToTilePosition(e){return this.assertSsIndexWithinSpritesheet(e),ae(e,Y.w)}calculateSpritesheetTileRegion(e){const t=ht[e],r=this.convertSsIndexToSsTilePosition(t);return{x:r.x*F,y:r.y*F,w:F,h:F}}convertCardinalNeighborsToTiling(e){let t=m.none;for(const[r,s]of Object.entries(e))s!==void 0&&(t|=m[r]);return t}convertSsIndexToSsTilePosition(e){return ae(e,Y.w)}isSsIndexWithinSpritesheet(e){return e<le}assertSsIndexWithinSpritesheet(e){if(!this.isSsIndexWithinSpritesheet(e))throw new Error("failed assert assertSsIndexWithinSpritesheet: "+e)}}const $e="active",it=125,H={h:25,s:99,l:57};function T(n){var e=document.createElement("div");return e.innerHTML=n.trim(),e.firstChild}function Xt(){return T('<button class="simple-button"></button>')}function Te(n){return T(`<div class="${n.join(" ")}"></div>`)}function ge(n,{invert:e=!1}={}){return T(`<img src="${n}" class="icon${e?" invert":""}">`)}const Vt="https://murolem.github.io/ostranauts_funsies/sprite-test/app/assets/trash-bin-black-Bnsn3vaF.png",Jt="https://murolem.github.io/ostranauts_funsies/sprite-test/app/assets/paint-brush-black-DGHBLeNn.png",Qt="https://murolem.github.io/ostranauts_funsies/sprite-test/app/assets/eraser-black-DRmb9ui2.png";function ie(n,e){const t=Te(["button-section",`name-${n}`]);return t.classList.add(),t.append(...e),t}const me="toggled",ot=new Je,lt="toggle";function je(n,e){const t={btn:n,toggledOn:e};ot.emit(lt,t)}function z(n,e){const t=T(`<button class="toggle-button ${n?n.join(" "):""}"></button>`);return e!==void 0&&t.append(e),t.addEventListener("click",()=>j(t,!ye(t))),t}function ye(n){return n.classList.contains(me)}function j(n,e){const t=ye(n);e!==t&&(e?(n.classList.add(me),je(n,!0)):(n.classList.remove(me),je(n,!1)))}function Q(n,e){ot.addListener(lt,t=>{t.btn===n&&e(n,t.toggledOn)})}function at(n,{keepToggleOn:e=!1}={}){n.forEach(t=>{Q(t,(r,s)=>{if(s)n.forEach(i=>{i!==t&&j(i,!1)});else{if(n.some(o=>ye(o)))return;j(t,!0)}})})}function Zt(n,e,t){const r=T('<label class="button-label-wrapping"></label>'),s=T(`<span class="button-label-text">${e}</span>`);return r.append(n),r.append(s),r}const en={Tab:9,Clear:12,Shift:16,Control:17,AltGraph:18,Alt:18,CapsLock:20,Escape:27,PageUp:33,PageDown:34,End:35,Home:36,ArrowLeft:37,ArrowUp:38,ArrowRight:39,ArrowDown:40,Insert:45,Delete:46,0:48,"=":48,1:49,"!":49,2:50,'"':50,3:51,"§":51,4:52,$:52,5:53,"%":53,6:54,"&":54,7:55,"/":55,8:56,"(":56,9:57,")":57,a:65,A:65,b:66,B:66,c:67,C:67,d:68,D:68,e:69,E:69,f:70,F:70,g:71,G:71,h:72,H:72,i:73,I:73,j:74,J:74,k:75,K:75,l:76,L:76,m:77,M:77,n:78,N:78,o:79,O:79,p:80,P:80,Q:81,r:82,R:82,s:83,S:83,t:84,T:84,u:85,U:85,v:86,V:86,w:87,W:87,x:88,X:88,y:89,Y:89,z:90,Z:90,Meta:92,F1:112,F2:113,Ü:186,"+":187,"*":187,",":188,";":188,"-":189,_:189,".":190,":":190,"#":191,"'":191,Ö:192,"?":219,"°":220,Ä:222},ct=[],X=[];function tn(n){return en[n]}window.addEventListener("keyup",n=>{const e=X.findIndex(t=>t.keyCode===n.keyCode);e!==-1&&X.splice(e,1)});window.addEventListener("keydown",n=>{X.findIndex(r=>r.keyCode===n.keyCode)===-1&&X.push({key:n.key,keyCode:n.keyCode});const t=ct.find(r=>r.keyCodes.includes(n.keyCode));t&&t.action([n.key],[n.keyCode])});function nn(n,e){ct.push({keys:[n],keyCodes:[n].map(tn),action:e})}function we(n,e,{setActiveForClickDuration:t=!1}={}){return nn(e,()=>{n.click(),t&&(n.classList.add($e),setTimeout(()=>n.classList.remove($e),it))}),Zt(n,e)}function Ue(n){if(n.tagName==="BUTTON")return n;if(n.tagName==="LABEL")return n.querySelector(":scope > button");throw console.error(n),new Error("failed to unwrap a button: unknown configuration (see above)")}function rn(n,e,t,r,s){return r+(n-e)*((s-r)/(t-e))}const sn=st,pe="active",V="data-ss-name",qe="tileset-placeholder",He="selected";let W=null,L=null,Se=null,ve=null,k=null;function on(){if(W)return;const n=Te(["tile-selection-window"]),e=T('<div class="header"></div>'),t=T('<span class="header-text">TILE SELECTION</span>'),r=T('<button class="close-button no-make-style"></button>');for(let c=0;c<3;c++)r.append(T('<span class="chevron"></span>'));r.addEventListener("click",()=>{Z(Se,!1,r)}),e.append(t,r);const s=T('<div class="sidebar"></div>'),i=T('<div class="sidebar-folders"></div>'),o=z(["folder","no-make-style"],"all"),l=z(["folder","no-make-style"],"core");z(["folder","no-make-style"],"my uploads"),o.click();const a=[o,l];at(a),i.append(...a);const u=T('<div class="sidebar-upload"></div>');u.append(T('<span><span class="bracket">&gt;</span> UPLOAD <span class="bracket">&lt;</span></span>')),s.append(i,u),k=T('<div class="explorer"></div>');for(const c of sn){const d=T(`<label class="tileset-label-wrapping" ${V}=${c.ssName}></label>`),v=T(`<div class="${qe}"></div>`);d.append(v,T(`<span class="label">${c.ssName}</span>`)),k.append(d)}_.addListener(Ze,c=>{ve=[c],ln(c),k.scrollTop=L.offsetTop+L.offsetHeight/2-k.clientHeight/2}),_.addListener(et,c=>{ve=c;for(const d of k.children){const v=d.getAttribute(V);if(!v)throw new Error("failed to extract tileset name from an explorer item");const f=c.find(h=>h.name===v);if(!f)throw new Error(`failed to find a matching spritesheets for an explorer item; ss name: ${v}`);const g=d.querySelector(`:scope > .${qe}`);if(!g)throw new Error(`failed to find a placeholder tileset for an explorer item; ss name: ${v}`);const w=T(`<img draggable="false" class="tileset" src="${f.imageUrl}">`);w.addEventListener("click",()=>ut(d)),g.replaceWith(w)}}),n.append(e,s,k),W=n,document.body.append(n)}function Z(n,e,t){let r=!1;W||(r=!0,Se=n,on());const s=()=>{e?W.classList.add(pe):W.classList.remove(pe),It(e,t)};r?setTimeout(s,10):s()}function ut(n){L&&L.classList.remove(He),L=n,L.classList.add(He);const e=n.getAttribute(V);if(!e)throw console.error(n),new Error("failed to select a tileset element in tileset select window: tileset name data attribute not set (see above)");const t=ve?.find(r=>r.name===e);if(!t)throw console.error(n),new Error("failed to select a tileset element in tileset select window: no matching tileset was found (see above)");Se.selectTileset(n,t)}function ln(n){un();const e=[...k.children].find(t=>{const r=t.getAttribute(V);if(!r)throw console.error(t),new Error("failed to select tileset element: ss name attribute is empty on element (see above)");if(r===n.name)return!0});if(!e)throw console.error(n),new Error("failed to select tileset element: no matching tileset element found, tileset: (see above)");ut(e)}function an(){return!!W}function cn(){return W?W.classList.contains(pe):!1}function un(){if(!an())throw new Error("failed assert isTilesetSelectionWindowCreated")}function dn(n){const e=Xt();return e.appendChild(ge(Vt,{invert:!0})),e.addEventListener("click",r=>n.reload?.(r.target)),we(e,"A",{setActiveForClickDuration:!0})}function Ye(n,e,t,r){const s=z(["tool-"+e]);return s.appendChild(r),Q(s,(i,o)=>{o&&n.selectTool(s,e)}),we(s,t)}function hn(n){const e=z(["button-tile"]);return _.addListener(Qe,()=>fn(e)),Q(e,(t,r)=>Z(n,r,e)),Pt((t,r)=>{r!==e&&j(e,t)}),we(e,"T")}function fn(n){const s=document.createElement("canvas"),i=getComputedStyle(n),o={w:n.clientWidth+parseFloat(i.paddingLeft)+parseFloat(i.paddingRight),h:n.clientHeight+parseFloat(i.paddingTop)+parseFloat(i.paddingBottom)},l=Math.floor(Math.min(o.w,o.h)/5);s.width=l*5,s.height=l*5;const a=s.getContext("2d");let u=!1;Q(n,(g,w)=>{u=w});const c={};function d(g){const S=g?g.toBrightness:q(0,1),y=q(0,1),p=y-S,B=Math.abs(p),x=q(250*B,1e3*B);let Ie=0,ee=g?g.t-1:0,Pe=!1;return{get fromBrightness(){return S},get toBrightness(){return y},get t(){return ee},get isDone(){return Pe},progress:te=>{Ie+=te,ee=Ie/x,ee>=1&&(Pe=!0)},sample:te=>S+p*te}}const v=Ve(`
                                                                                                X       x
                                                                         
                                                        X
                                                
                                        
        x             x
`),f=g=>{const h=performance.now()-g;a.clearRect(0,0,s.width,s.height);for(let y=0;y<3**2;y++){let p=Ke(c,y,d);p.progress(h),p.isDone&&(p=d(p),c[y]=p)}let S=0;for(let y=1;y<4;y++)for(let p=1;p<4;p++){const B=c[S],x=B.sample(v(B.t));a.fillStyle=u?`hsl(${H.h}, ${H.s}%, ${H.l*rn(x,0,1,.4,1)}%)`:`hsl(0, 0%, 55%,  ${x})`,a.fillRect(p*l,y*l,l,l),S++}requestAnimationFrame(f)};n.append(s),requestAnimationFrame(f)}function gn(n){const e=T('<img draggable="false" class="tile-screen">');return Ee(t=>e.src=t.imageUrl),Ee(t=>e.src=t.imageUrl),e.addEventListener("click",()=>{Z(n,!cn(),e)}),e}function mn(n){const e=Te(["gui-container","dock-top"]),t=Ye(n,"brush","B",ge(Jt,{invert:!0}));j(Ue(t),!0);const r=[t,Ye(n,"eraser","E",ge(Qt,{invert:!0}))];return at(r.map(Ue)),e.append(ie("reload",[dn(n)]),ie("tools",r),ie("tile-select",[hn(n),gn(n)])),e}function pn(){const n=document.querySelector(":root");n.style.setProperty("--btn-press-anim-duration",it+"ms");let e=H;n.style.setProperty("--toggle-col",`hsl(${e.h}, ${e.s}%, ${e.l}%)`)}function vn(n,e){pn();const t=[mn(e)];Z(e,!1,void 0),n.parentElement.append(...t),St()}if(Object.keys(oe).length!==le)throw new Error(`mismatch between configuring spritesheet size and tiles and defined mappings: ss size set to ${le} tiles, while index mappings configured for ${Object.keys(oe).length} tiles`);const E=ft(document.getElementById("canvas"),"canvas element not found");if(E.tagName!=="CANVAS")throw new Error("canvas element is not a canvas element, found: "+E.tagName);const N=E.getContext("2d");if(!N)throw new Error("2d rendering context unsupported");const bn=await J.loadRandomCoreTileset(),Tn=J.loadCoreTilesets(),M=new bt(E,N),R=new At(M,bn);let Ce=!1,xe=!1,be={x:0,y:0};window.addEventListener("mousedown",()=>Ce=!0);window.addEventListener("mouseup",()=>Ce=!1);E.addEventListener("mousedown",()=>xe=!0);E.addEventListener("mouseup",()=>xe=!1);E.addEventListener("mousemove",n=>{be.x=n.offsetX,be.y=n.offsetY});vn(E,{reload:n=>{M.clear()},selectTool:(n,e)=>{R.setMode(e)},selectTileset:(n,e)=>{R.setTileset(e)}});Ct(R.tileset);nt(R.tileset);Tn.then(n=>xt(n));function dt(){if(N.save(),N.imageSmoothingEnabled=!1,N.fillStyle="hsl(0, 0%, 15%)",N.fillRect(0,0,M.sizePixelsPadded.w,M.sizePixelsPadded.h),Ce&&xe){const n=M.convertPxPositionToTilePos(be);R.tryApplyAt(n)}M.draw(R),N.restore(),requestAnimationFrame(dt)}dt();
