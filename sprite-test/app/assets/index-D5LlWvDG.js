(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();function _e(n,e,t){let r=n[e];return r||(r=t(),n[e]=r),r}const g={none:0,left:1,up:2,right:4,down:8},X={0:g.right|g.down,1:g.left|g.down|g.right,2:g.left|g.down,3:g.up,4:g.up|g.right|g.down,5:g.left|g.up|g.right|g.down,6:g.up|g.left|g.down,7:g.right,8:g.up|g.right,9:g.left|g.up|g.right,10:g.up|g.left,11:g.left,12:g.left|g.right,13:g.none,14:g.up|g.down,15:g.down},$e=Object.entries(X).reduce((n,[e,t])=>{if(_e(n,t,()=>parseInt(e))!=parseInt(e))throw new Error("failed to create tiling mapping: found a duplicate tiling rule: "+t.toString(2));return n},{}),Ee={left:{x:-1,y:0},up:{x:0,y:-1},right:{x:1,y:0},down:{x:0,y:1}};function Ue(n,e){if(n==null)throw new Error(e);return n}const O=16,Ke=3,D=Object.freeze({w:4,h:4}),qe="spritesheets",V=D.w*D.h,w=O*Ke;function Ye(n,e){return e*n.y+n.x}function J(n,e){const t=Math.floor(n/e);return{x:n-e*t,y:t}}function He(n,e,t){return Math.max(Math.min(n,t),e)}function fe(n,e){for(var t=1,r=n-e+1;r<=n;r++)t*=r;for(var r=1;r<=e;r++)t/=r;return t}function Xe(n,e){var t=e.length-1,r=0,i=0;for(let o=0;o<=t;o++)i=i+fe(t,o)*Math.pow(1-n,t-o)*Math.pow(n,o)*e[o].x,r=r+fe(t,o)*Math.pow(1-n,t-o)*Math.pow(n,o)*e[o].y;return r}function Be(n){let e=n.split(`
`);e=e.slice(1,e.length-1);const t=e.reduce((s,l)=>l.length>s?l.length:s,0),r=1/t,i=1/e.length,o=[];for(let s=0;s<t;s++){for(const[l,a]of e.entries()){const c=a[s];if(c!==void 0&&c!==" "){const u={x:s*r,y:(e.length-l)*i};o.push(u);continue}}[...e.entries()].find(([l,a])=>{const c=a[s];return c!==void 0&&c!==" "})}return function(s){return Xe(s,o)}}function K(n,e,t){return n>=e&&n<=t}class Ve{constructor(e,t){this._canvas=e,this._ctx=t,this._sizeTiles=Object.freeze({w:Math.floor(e.clientWidth/w),h:Math.floor(e.clientHeight/w)}),this._sizePixels=Object.freeze({w:this.sizeTiles.w*w,h:this.sizeTiles.h*w}),e.width=this._sizePixels.w,e.height=this._sizePixels.h,e.classList.add("initialized")}get sizeTiles(){return this._sizeTiles}_sizeTiles;get sizePixelsPadded(){return this._sizePixels}_sizePixels;_grid={};_scheduledClearDurationMs=150;_clearScheduleAtTs=null;_sampleClearCurve=Be(`
                                                                                        X       x
                                                                 
                                                X
                                        
                                
x             x
`);convertPxPositionToTilePos(e){return{x:Math.floor(e.x/w),y:Math.floor(e.y/w)}}convertTilePositionToTileGridIndex(e){return Ye(e,this.sizeTiles.w)}convertTileGridIndexToTilePosition(e){return J(e,this.sizeTiles.w)}get(e){const t=typeof e=="number"?e:this.convertTilePositionToTileGridIndex(e);return this._grid[t]}getCardinalNeighbors(e){const t={left:void 0,up:void 0,right:void 0,down:void 0};for(const[r,i]of Object.entries(Ee)){const o=r,s={x:e.x+i.x,y:e.y+i.y};this.isTilePositionWithinGrid(s)&&(t[o]=this.get(s))}return t}set(e,t){const r=typeof e=="number"?e:this.convertTilePositionToTileGridIndex(e),i=t;this.assertGridIndexWithinGrid(r),i===void 0?delete this._grid[r]:this._grid[r]=i}hasAt(e){const t=typeof e=="number"?e:this.convertTilePositionToTileGridIndex(e);return this.assertGridIndexWithinGrid(t),this._grid[t]!==void 0}draw(e){this._tryScheduledClearIfAny();const t=this._ctx;t.strokeStyle="hsl(0, 0%, 20%)";for(let s=0;s<=this.sizeTiles.w;s++){const l={x:w*s,y:0},a={x:w*s,y:this.sizePixelsPadded.h};t.beginPath(),t.moveTo(l.x,l.y),t.lineTo(a.x,a.y),t.stroke()}for(let s=0;s<=this.sizeTiles.h;s++){const l={x:0,y:w*s},a={x:this.sizePixelsPadded.w,y:w*s};t.beginPath(),t.moveTo(l.x,l.y),t.lineTo(a.x,a.y),t.stroke()}const r=this._isClearScheduled();let i=0,o=0;if(r){const s=this._getScheduledClearProgress();i=this._sampleClearCurve(s),o=w/2*i}for(let[s,l]of Object.entries(this._grid)){if(l===void 0)continue;const a=parseInt(s),c=this.convertTileGridIndexToTilePosition(a),u={x:c.x*w,y:c.y*w},h=e.tileset.calculateSpritesheetTileRegion(l);t.save(),t.translate(u.x,u.y),r&&(t.translate(o,o),t.scale(1-i,1-i)),t.drawImage(e.tileset.image,h.x,h.y,h.w,h.h,0,0,w,w),t.restore()}}clear(){this._isClearScheduled()||(this._clearScheduleAtTs=Date.now()+this._scheduledClearDurationMs)}_tryScheduledClearIfAny(){this._isClearScheduled()&&this._clearScheduleAtTs<=Date.now()&&(this._grid={},this._clearScheduleAtTs=null)}_getScheduledClearProgress(){if(!this._isClearScheduled())return 0;const t=1-(this._clearScheduleAtTs-Date.now())/this._scheduledClearDurationMs;return He(t,0,1)}_isClearScheduled(){return this._clearScheduleAtTs!==null}isTilePositionWithinGrid(e){return K(e.x,0,this.sizeTiles.w-1)&&K(e.y,0,this.sizeTiles.h-1)}isGridIndexWithinGrid(e){return K(e,0,this.sizeTiles.w*this.sizeTiles.h)}assertTilePositionWithinGrid(e){if(!this.isTilePositionWithinGrid(e))throw new Error("failed assert assertIsTilePositionWithinGrid: "+e)}assertGridIndexWithinGrid(e){if(!this.isGridIndexWithinGrid(e))throw new Error("failed assert assertGridIndexWithinGrid: "+e)}}class Je{constructor(e,t){this._grid=e,this._tileset=t}get tileset(){return this._tileset}mode="brush";setTileset(e){this._tileset=e}setMode(e){this.mode=e}tryApplyAt(e){if(!this._grid.isTilePositionWithinGrid(e))return;const t=this._grid.getCardinalNeighbors(e);switch(this.mode){case"brush":this.applyBrushMode(e,t);break;case"eraser":this.applyEraserMode(e);break;default:throw new Error("not impl brush mode: "+this.mode)}for(const[r,i]of Object.entries(t)){const o=r;if(i===void 0)continue;const s=Ee[o],l={x:e.x+s.x,y:e.y+s.y},a=this._grid.getCardinalNeighbors(l),c=this._tileset.convertCardinalNeighborsToTiling(a);this._grid.set(l,c)}}applyBrushMode(e,t){if(this._grid.hasAt(e))return;const r=this._tileset.convertCardinalNeighborsToTiling(t);this._grid.set(e,r)}applyEraserMode(e){this._grid.hasAt(e)&&this._grid.set(e,void 0)}}const Qe=[{relPath:"ItmSealTemp01Sheet.png"},{relPath:"ItmWallBlueCaution01Loose.png"},{relPath:"ItmWallBlueCaution01Sheet.png"},{relPath:"ItmWallGrayBevel01Sheet.png"},{relPath:"ItmWallGrayCaution01Sheet.png"},{relPath:"ItmWallGrayPanel01Sheet.png"},{relPath:"ItmWallGreenCross01Sheet.png"},{relPath:"ItmWallGreenRing01Sheet.png"},{relPath:"ItmWallMetalBSheet.png"},{relPath:"ItmWallPanelWSheet.png"},{relPath:"ItmWallPurpleCross01Sheet.png"},{relPath:"ItmWallRedBand01Sheet.png"},{relPath:"ItmWallRedCross01Sheet.png"},{relPath:"ItmWallSheet.png"},{relPath:"ItmWallTanOrange01Sheet.png"},{relPath:"ItmWallThin1x1BlueSheet.png"},{relPath:"ItmWallThin1x1GrayCautionSheet.png"},{relPath:"ItmWallThin1x1GrayCautionSheet02.png"},{relPath:"ItmWallThin1x1GraySheet.png"},{relPath:"ItmWallThin1x1GreenSheet.png"},{relPath:"ItmWallThin1x1OrangeSheet.png"},{relPath:"ItmWallThin1x1RedSheet.png"},{relPath:"ItmWallThin1x1YellowSheet.png"},{relPath:"ItmWallWhiteCross01Sheet.png"},{relPath:"ItmWallWindowSheet.png"},{relPath:"ItmWallWindowSheetSq.png"},{relPath:"ItmWallYellowCaution01Sheet.png"},{relPath:"AeroParts/ItmWallAeroSheet.png"},{relPath:"AeroParts/ItmWallAeroSheetSq.png"},{relPath:"ItmFloorGrate12A/ItmWallAeroExtWhite01Sheet.png"},{relPath:"ItmFloorGrate12A/ItmWallAeroInt01Sheet.png"},{relPath:"ItmFloorGrate12A/ItmWallAeroInt02Sheet.png"},{relPath:"ItmFloorGrate12A/ItmWallAeroInt03Sheet.png"},{relPath:"ItmFloorGrate12A/ItmWallAeroInt04Sheet.png"},{relPath:"Meat01/ItmMeat01EyeSheet.png"},{relPath:"Meat01/ItmMeat01HoofSheet.png"},{relPath:"Meat01/ItmMeat01HornSheet.png"},{relPath:"Meat01/ItmMeat01Sheet.png"}];function P(n){if(typeof n!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(n))}function de(n,e){for(var t="",r=0,i=-1,o=0,s,l=0;l<=n.length;++l){if(l<n.length)s=n.charCodeAt(l);else{if(s===47)break;s=47}if(s===47){if(!(i===l-1||o===1))if(i!==l-1&&o===2){if(t.length<2||r!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){var a=t.lastIndexOf("/");if(a!==t.length-1){a===-1?(t="",r=0):(t=t.slice(0,a),r=t.length-1-t.lastIndexOf("/")),i=l,o=0;continue}}else if(t.length===2||t.length===1){t="",r=0,i=l,o=0;continue}}e&&(t.length>0?t+="/..":t="..",r=2)}else t.length>0?t+="/"+n.slice(i+1,l):t=n.slice(i+1,l),r=l-i-1;i=l,o=0}else s===46&&o!==-1?++o:o=-1}return t}function Ze(n,e){var t=e.dir||e.root,r=e.base||(e.name||"")+(e.ext||"");return t?t===e.root?t+r:t+n+r:r}var S={process_cwd:"",setCWD:function(e){S.process_cwd=e},resolve:function(){for(var e="",t=!1,r,i=arguments.length-1;i>=-1&&!t;i--){var o;i>=0?o=arguments[i]:(r===void 0&&(r=S.process_cwd),o=r),P(o),o.length!==0&&o+"/"!==e&&(e=o+"/"+e,t=o.charCodeAt(0)===47)}return e=de(e,!t),t?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(P(e),e.length===0)return".";var t=e.charCodeAt(0)===47,r=e.charCodeAt(e.length-1)===47;return e=de(e,!t),e.length===0&&!t&&(e="."),e.length>0&&r&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return P(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,t=0;t<arguments.length;++t){var r=arguments[t];P(r),r.length>0&&(e===void 0?e=r:e+="/"+r)}return e===void 0?".":S.normalize(e)},relative:function(e,t){if(P(e),P(t),e===t)return"";const r=e.replaceAll("\\","/"),i=t.replaceAll("\\","/");if(r!=e&&i!=t)return S.relative(r,i).replaceAll("/","\\");if(r!=e)return S.relative(r,t).replaceAll("/","\\");if(i!=t)return S.relative(e,i);if(e=S.resolve(e),t=S.resolve(t),e===t)return"";for(var o=1;o<e.length&&e.charCodeAt(o)===47;++o);for(var s=e.length,l=s-o,a=1;a<t.length&&t.charCodeAt(a)===47;++a);for(var c=t.length,u=c-a,h=l<u?l:u,v=-1,d=0;d<=h;++d){if(d===h){if(u>h){if(t.charCodeAt(a+d)===47)return t.slice(a+d+1);if(d===0)return t.slice(a+d)}else l>h&&(e.charCodeAt(o+d)===47?v=d:d===0&&(v=0));break}var p=e.charCodeAt(o+d),x=t.charCodeAt(a+d);if(p!==x)break;p===47&&(v=d)}var f="";for(d=o+v+1;d<=s;++d)(d===s||e.charCodeAt(d)===47)&&(f.length===0?f+="..":f+="/..");return f.length>0?f+t.slice(a+v):(a+=v,t.charCodeAt(a)===47&&++a,t.slice(a))},_makeLong:function(e){return e},dirname:function(e){if(P(e),e.length===0)return".";for(var t=e.charCodeAt(0),r=t===47,i=-1,o=!0,s=e.length-1;s>=1;--s)if(t=e.charCodeAt(s),t===47){if(!o){i=s;break}}else o=!1;return i===-1?r?"/":".":r&&i===1?"//":e.slice(0,i)},basename:function(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');P(e);var r=0,i=-1,o=!0,s;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var l=t.length-1,a=-1;for(s=e.length-1;s>=0;--s){var c=e.charCodeAt(s);if(c===47){if(!o){r=s+1;break}}else a===-1&&(o=!1,a=s+1),l>=0&&(c===t.charCodeAt(l)?--l===-1&&(i=s):(l=-1,i=a))}return r===i?i=a:i===-1&&(i=e.length),e.slice(r,i)}else{for(s=e.length-1;s>=0;--s)if(e.charCodeAt(s)===47){if(!o){r=s+1;break}}else i===-1&&(o=!1,i=s+1);return i===-1?"":e.slice(r,i)}},extname:function(e){P(e);for(var t=-1,r=0,i=-1,o=!0,s=0,l=e.length-1;l>=0;--l){var a=e.charCodeAt(l);if(a===47){if(!o){r=l+1;break}continue}i===-1&&(o=!1,i=l+1),a===46?t===-1?t=l:s!==1&&(s=1):t!==-1&&(s=-1)}return t===-1||i===-1||s===0||s===1&&t===i-1&&t===r+1?"":e.slice(t,i)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return Ze("/",e)},parse:function(e){P(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;var r=e.charCodeAt(0),i=r===47,o;i?(t.root="/",o=1):o=0;for(var s=-1,l=0,a=-1,c=!0,u=e.length-1,h=0;u>=o;--u){if(r=e.charCodeAt(u),r===47){if(!c){l=u+1;break}continue}a===-1&&(c=!1,a=u+1),r===46?s===-1?s=u:h!==1&&(h=1):s!==-1&&(h=-1)}return s===-1||a===-1||h===0||h===1&&s===a-1&&s===l+1?a!==-1&&(l===0&&i?t.base=t.name=e.slice(1,a):t.base=t.name=e.slice(l,a)):(l===0&&i?(t.name=e.slice(1,s),t.base=e.slice(1,a)):(t.name=e.slice(l,s),t.base=e.slice(l,a)),t.ext=e.slice(s,a)),l>0?t.dir=e.slice(0,l-1):i&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};S.posix=S;async function et(n){await new Promise(e=>setTimeout(e,n))}const q=10,ge=(n=0)=>e=>`\x1B[${e+n}m`,pe=(n=0)=>e=>`\x1B[${38+n};5;${e}m`,me=(n=0)=>(e,t,r)=>`\x1B[${38+n};2;${e};${t};${r}m`,b={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],gray:[90,39],grey:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgGray:[100,49],bgGrey:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};Object.keys(b.modifier);const tt=Object.keys(b.color),nt=Object.keys(b.bgColor);[...tt,...nt];function rt(){const n=new Map;for(const[e,t]of Object.entries(b)){for(const[r,i]of Object.entries(t))b[r]={open:`\x1B[${i[0]}m`,close:`\x1B[${i[1]}m`},t[r]=b[r],n.set(i[0],i[1]);Object.defineProperty(b,e,{value:t,enumerable:!1})}return Object.defineProperty(b,"codes",{value:n,enumerable:!1}),b.color.close="\x1B[39m",b.bgColor.close="\x1B[49m",b.color.ansi=ge(),b.color.ansi256=pe(),b.color.ansi16m=me(),b.bgColor.ansi=ge(q),b.bgColor.ansi256=pe(q),b.bgColor.ansi16m=me(q),Object.defineProperties(b,{rgbToAnsi256:{value(e,t,r){return e===t&&t===r?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(t/255*5)+Math.round(r/255*5)},enumerable:!1},hexToRgb:{value(e){const t=/[a-f\d]{6}|[a-f\d]{3}/i.exec(e.toString(16));if(!t)return[0,0,0];let[r]=t;r.length===3&&(r=[...r].map(o=>o+o).join(""));const i=Number.parseInt(r,16);return[i>>16&255,i>>8&255,i&255]},enumerable:!1},hexToAnsi256:{value:e=>b.rgbToAnsi256(...b.hexToRgb(e)),enumerable:!1},ansi256ToAnsi:{value(e){if(e<8)return 30+e;if(e<16)return 90+(e-8);let t,r,i;if(e>=232)t=((e-232)*10+8)/255,r=t,i=t;else{e-=16;const l=e%36;t=Math.floor(e/36)/5,r=Math.floor(l/6)/5,i=l%6/5}const o=Math.max(t,r,i)*2;if(o===0)return 30;let s=30+(Math.round(i)<<2|Math.round(r)<<1|Math.round(t));return o===2&&(s+=60),s},enumerable:!1},rgbToAnsi:{value:(e,t,r)=>b.ansi256ToAnsi(b.rgbToAnsi256(e,t,r)),enumerable:!1},hexToAnsi:{value:e=>b.ansi256ToAnsi(b.hexToAnsi256(e)),enumerable:!1}}),b}const A=rt(),ve=(()=>{if(!("navigator"in globalThis))return 0;if(globalThis.navigator.userAgentData){const n=navigator.userAgentData.brands.find(({brand:e})=>e==="Chromium");if(n&&n.version>93)return 3}return/\b(Chrome|Chromium)\//.test(globalThis.navigator.userAgent)?1:0})(),be=ve!==0&&{level:ve},it={stdout:be,stderr:be};function ot(n,e,t){let r=n.indexOf(e);if(r===-1)return n;const i=e.length;let o=0,s="";do s+=n.slice(o,r)+e+t,o=r+i,r=n.indexOf(e,o);while(r!==-1);return s+=n.slice(o),s}function st(n,e,t,r){let i=0,o="";do{const s=n[r-1]==="\r";o+=n.slice(i,s?r-1:r)+e+(s?`\r
`:`
`)+t,i=r+1,r=n.indexOf(`
`,i)}while(r!==-1);return o+=n.slice(i),o}const{stdout:ye,stderr:Te}=it,Q=Symbol("GENERATOR"),B=Symbol("STYLER"),R=Symbol("IS_EMPTY"),we=["ansi","ansi","ansi256","ansi16m"],M=Object.create(null),lt=(n,e={})=>{if(e.level&&!(Number.isInteger(e.level)&&e.level>=0&&e.level<=3))throw new Error("The `level` option should be an integer from 0 to 3");const t=ye?ye.level:0;n.level=e.level===void 0?t:e.level},at=n=>{const e=(...t)=>t.join(" ");return lt(e,n),Object.setPrototypeOf(e,G.prototype),e};function G(n){return at(n)}Object.setPrototypeOf(G.prototype,Function.prototype);for(const[n,e]of Object.entries(A))M[n]={get(){const t=z(this,ee(e.open,e.close,this[B]),this[R]);return Object.defineProperty(this,n,{value:t}),t}};M.visible={get(){const n=z(this,this[B],!0);return Object.defineProperty(this,"visible",{value:n}),n}};const Z=(n,e,t,...r)=>n==="rgb"?e==="ansi16m"?A[t].ansi16m(...r):e==="ansi256"?A[t].ansi256(A.rgbToAnsi256(...r)):A[t].ansi(A.rgbToAnsi(...r)):n==="hex"?Z("rgb",e,t,...A.hexToRgb(...r)):A[t][n](...r),ct=["rgb","hex","ansi256"];for(const n of ct){M[n]={get(){const{level:t}=this;return function(...r){const i=ee(Z(n,we[t],"color",...r),A.color.close,this[B]);return z(this,i,this[R])}}};const e="bg"+n[0].toUpperCase()+n.slice(1);M[e]={get(){const{level:t}=this;return function(...r){const i=ee(Z(n,we[t],"bgColor",...r),A.bgColor.close,this[B]);return z(this,i,this[R])}}}}const ut=Object.defineProperties(()=>{},{...M,level:{enumerable:!0,get(){return this[Q].level},set(n){this[Q].level=n}}}),ee=(n,e,t)=>{let r,i;return t===void 0?(r=n,i=e):(r=t.openAll+n,i=e+t.closeAll),{open:n,close:e,openAll:r,closeAll:i,parent:t}},z=(n,e,t)=>{const r=(...i)=>ht(r,i.length===1?""+i[0]:i.join(" "));return Object.setPrototypeOf(r,ut),r[Q]=n,r[B]=e,r[R]=t,r},ht=(n,e)=>{if(n.level<=0||!e)return n[R]?"":e;let t=n[B];if(t===void 0)return e;const{openAll:r,closeAll:i}=t;if(e.includes("\x1B"))for(;t!==void 0;)e=ot(e,t.close,t.open),t=t.parent;const o=e.indexOf(`
`);return o!==-1&&(e=st(e,i,r,o)),r+e+i};Object.defineProperties(G.prototype,M);const L=G();G({level:Te?Te.level:0});const te={DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ft={DEBUG:n=>L.gray(n),INFO:n=>n,WARN:n=>L.yellow(n),ERROR:n=>L.red(n),FATAL:n=>L.bgRed(n)};let ne="INFO",xe=te[ne];const dt={};class gt{logPrefix="";constructor(e){this.logPrefix=e}static setLogLevel(e){ne=e,xe=te[ne]}setLogPrefix=e=>{this.logPrefix=e};log=(e,t,...r)=>{if(te[e]<xe)return;const i=typeof t=="object",o=i?t.msg:t,s=i?t:dt;let l;e==="DEBUG"||e==="INFO"?l=console.log:e==="WARN"?l=console.warn:e==="ERROR"||e==="FATAL"?l=console.error:l=console.log;const a=ft[e],c=o.split(`
`);for(let u=0;u<c.length;u++)l(a(`${L.bold(e.toLowerCase())}: [${this.logPrefix}] ${c[u]}`));if(r.length>0&&l(...r),s.data!==void 0&&(s.stringifyData?l(JSON.stringify(s.data,null,4)):l(s.data)),s.throw)throw new Error("see previous message")};logDebug=(e,...t)=>{this.log("DEBUG",e,...t)};logInfo=(e,...t)=>{this.log("INFO",e,...t)};logWarn=(e,...t)=>{this.log("WARN",e,...t)};logError=(e,...t)=>{this.log("ERROR",e,...t)};logFatal=(e,...t)=>{this.log("FATAL",e,...t)}}const pt=new gt("lib/spritesheets"),{logFatal:mt}=pt,vt=Qe;class le{constructor(e,t,r){this._relUrlFilepath=e,this._filename=t,this._image=r}get relUrlFilepath(){return this._relUrlFilepath}get filename(){return this._filename}get image(){return this._image}static async loadDefault(){const e=[];for(const t of vt){const r=`${qe}/${t.relPath}`,i=fetch(r).then(o=>o.blob()).then(createImageBitmap).then(o=>new le(r,S.parse(t.relPath).base,o)).catch(o=>{throw mt({msg:"error while loading spritesheets",throw:!0,data:{spritesheet:r,error:o}}),""});e.push(i),await et(25)}return Promise.all(e)}convertSsIndexToTilePosition(e){return this.assertSsIndexWithinSpritesheet(e),J(e,D.w)}calculateSpritesheetTileRegion(e){const t=$e[e],r=this.convertSsIndexToSsTilePosition(t);return{x:r.x*O,y:r.y*O,w:O,h:O}}convertCardinalNeighborsToTiling(e){let t=g.none;for(const[r,i]of Object.entries(e))i!==void 0&&(t|=g[r]);return t}convertSsIndexToSsTilePosition(e){return J(e,D.w)}isSsIndexWithinSpritesheet(e){return e<V}assertSsIndexWithinSpritesheet(e){if(!this.isSsIndexWithinSpritesheet(e))throw new Error("failed assert assertSsIndexWithinSpritesheet: "+e)}}function F(n,e){return Array.isArray(n)?(e=n[1],n=n[0]):e===void 0&&(e=n,n=0),n+Math.random()*(e-n)}function bt(...n){return Math.round(F.apply(null,n))}function yt(n){return n.length>0?bt(n.length-1):-1}function Tt(n){return n[yt(n)]}const Se="active",Me=125;function k(n){var e=document.createElement("div");return e.innerHTML=n.trim(),e.firstChild}function wt(){return k('<button class="simple-button"></button>')}function ke(n){return k(`<div class="${n.join(" ")}"></div>`)}function re(n,{invert:e=!1}={}){return k(`<img src="${n}" class="icon${e?" invert":""}">`)}const xt="https://murolem.github.io/ostranauts_funsies/sprite-test/app/assets/trash-bin-black-Bnsn3vaF.png",St="https://murolem.github.io/ostranauts_funsies/sprite-test/app/assets/paint-brush-black-DGHBLeNn.png",Pt="https://murolem.github.io/ostranauts_funsies/sprite-test/app/assets/eraser-black-DRmb9ui2.png";function Y(n,e){const t=ke(["button-section",`name-${n}`]);return t.classList.add(),t.append(...e),t}function At(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var H={exports:{}},Pe;function Ct(){return Pe||(Pe=1,function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(a,c,u){this.fn=a,this.context=c,this.once=u||!1}function o(a,c,u,h,v){if(typeof u!="function")throw new TypeError("The listener must be a function");var d=new i(u,h||a,v),p=t?t+c:c;return a._events[p]?a._events[p].fn?a._events[p]=[a._events[p],d]:a._events[p].push(d):(a._events[p]=d,a._eventsCount++),a}function s(a,c){--a._eventsCount===0?a._events=new r:delete a._events[c]}function l(){this._events=new r,this._eventsCount=0}l.prototype.eventNames=function(){var c=[],u,h;if(this._eventsCount===0)return c;for(h in u=this._events)e.call(u,h)&&c.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},l.prototype.listeners=function(c){var u=t?t+c:c,h=this._events[u];if(!h)return[];if(h.fn)return[h.fn];for(var v=0,d=h.length,p=new Array(d);v<d;v++)p[v]=h[v].fn;return p},l.prototype.listenerCount=function(c){var u=t?t+c:c,h=this._events[u];return h?h.fn?1:h.length:0},l.prototype.emit=function(c,u,h,v,d,p){var x=t?t+c:c;if(!this._events[x])return!1;var f=this._events[x],y=arguments.length,T,m;if(f.fn){switch(f.once&&this.removeListener(c,f.fn,void 0,!0),y){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,u),!0;case 3:return f.fn.call(f.context,u,h),!0;case 4:return f.fn.call(f.context,u,h,v),!0;case 5:return f.fn.call(f.context,u,h,v,d),!0;case 6:return f.fn.call(f.context,u,h,v,d,p),!0}for(m=1,T=new Array(y-1);m<y;m++)T[m-1]=arguments[m];f.fn.apply(f.context,T)}else{var W=f.length,C;for(m=0;m<W;m++)switch(f[m].once&&this.removeListener(c,f[m].fn,void 0,!0),y){case 1:f[m].fn.call(f[m].context);break;case 2:f[m].fn.call(f[m].context,u);break;case 3:f[m].fn.call(f[m].context,u,h);break;case 4:f[m].fn.call(f[m].context,u,h,v);break;default:if(!T)for(C=1,T=new Array(y-1);C<y;C++)T[C-1]=arguments[C];f[m].fn.apply(f[m].context,T)}}return!0},l.prototype.on=function(c,u,h){return o(this,c,u,h,!1)},l.prototype.once=function(c,u,h){return o(this,c,u,h,!0)},l.prototype.removeListener=function(c,u,h,v){var d=t?t+c:c;if(!this._events[d])return this;if(!u)return s(this,d),this;var p=this._events[d];if(p.fn)p.fn===u&&(!v||p.once)&&(!h||p.context===h)&&s(this,d);else{for(var x=0,f=[],y=p.length;x<y;x++)(p[x].fn!==u||v&&!p[x].once||h&&p[x].context!==h)&&f.push(p[x]);f.length?this._events[d]=f.length===1?f[0]:f:s(this,d)}return this},l.prototype.removeAllListeners=function(c){var u;return c?(u=t?t+c:c,this._events[u]&&s(this,u)):(this._events=new r,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=t,l.EventEmitter=l,n.exports=l}(H)),H.exports}var It=Ct();const We=At(It),ie="toggled",Oe=new We,Le="toggle";function Ae(n,e){const t={btn:n,toggledOn:e};Oe.emit(Le,t)}function Re(n){const e=k(`<button class="toggle-button ${n?n.join(" "):""}"></button>`);return e.addEventListener("click",()=>N(e,!ae(e))),e}function ae(n){return n.classList.contains(ie)}function N(n,e){const t=ae(n);e!==t&&(e?(n.classList.add(ie),Ae(n,!0)):(n.classList.remove(ie),Ae(n,!1)))}function Ge(n,e){Oe.addListener(Le,t=>{t.btn===n&&e(n,t.toggledOn)})}function _t(n,{keepToggleOn:e=!1}={}){n.forEach(t=>{Ge(t,(r,i)=>{if(i)n.forEach(o=>{o!==t&&N(o,!1)});else{if(n.some(s=>ae(s)))return;N(t,!0)}})})}function Et(n,e,t){const r=k('<label class="button-label-wrapping"></label>'),i=k(`<span class="button-label-text">${e}</span>`);return r.append(n),r.append(i),r}const Bt={Tab:9,Clear:12,Shift:16,Control:17,AltGraph:18,Alt:18,CapsLock:20,Escape:27,PageUp:33,PageDown:34,End:35,Home:36,ArrowLeft:37,ArrowUp:38,ArrowRight:39,ArrowDown:40,Insert:45,Delete:46,0:48,"=":48,1:49,"!":49,2:50,'"':50,3:51,"§":51,4:52,$:52,5:53,"%":53,6:54,"&":54,7:55,"/":55,8:56,"(":56,9:57,")":57,a:65,A:65,b:66,B:66,c:67,C:67,d:68,D:68,e:69,E:69,f:70,F:70,g:71,G:71,h:72,H:72,i:73,I:73,j:74,J:74,k:75,K:75,l:76,L:76,m:77,M:77,n:78,N:78,o:79,O:79,p:80,P:80,Q:81,r:82,R:82,s:83,S:83,t:84,T:84,u:85,U:85,v:86,V:86,w:87,W:87,x:88,X:88,y:89,Y:89,z:90,Z:90,Meta:92,F1:112,F2:113,Ü:186,"+":187,"*":187,",":188,";":188,"-":189,_:189,".":190,":":190,"#":191,"'":191,Ö:192,"?":219,"°":220,Ä:222},Fe=[],j=[];function Mt(n){return Bt[n]}window.addEventListener("keyup",n=>{const e=j.findIndex(t=>t.keyCode===n.keyCode);e!==-1&&j.splice(e,1)});window.addEventListener("keydown",n=>{j.findIndex(r=>r.keyCode===n.keyCode)===-1&&j.push({key:n.key,keyCode:n.keyCode});const t=Fe.find(r=>r.keyCodes.includes(n.keyCode));t&&t.action([n.key],[n.keyCode])});function kt(n,e){Fe.push({keys:[n],keyCodes:[n].map(Mt),action:e})}function De(n,e,{setActiveForClickDuration:t=!1}={}){return kt(e,()=>{n.click(),t&&(n.classList.add(Se),setTimeout(()=>n.classList.remove(Se),Me))}),Et(n,e)}function Ce(n){if(n.tagName==="BUTTON")return n;if(n.tagName==="LABEL")return n.querySelector(":scope > button");throw console.error(n),new Error("failed to unwrap a button: unknown configuration (see above)")}const ze=new We,Ne="gui-built";function Wt(){ze.emit(Ne)}function Ot(n){const e=wt();return e.appendChild(re(xt,{invert:!0})),e.addEventListener("click",r=>n.reload?.(r.target)),De(e,"A",{setActiveForClickDuration:!0})}function Ie(n,e,t,r){const i=Re(["tool-"+e]);return i.appendChild(r),Ge(i,(o,s)=>{s&&n.selectTool(i,e)}),De(i,t)}function Lt(){const n=Re(["button-tile"]);return ze.addListener(Ne,()=>Rt(n)),n}function Rt(n){const i=document.createElement("canvas"),o=getComputedStyle(n),s={w:n.clientWidth+parseFloat(o.paddingLeft)+parseFloat(o.paddingRight),h:n.clientHeight+parseFloat(o.paddingTop)+parseFloat(o.paddingBottom)},l=Math.min(s.w,s.h)/5;i.width=l*5,i.height=l*5;const a=i.getContext("2d"),c={};function u(d){const f=d?d.toBrightness:F(0,1),y=F(0,1),T=y-f,m=Math.abs(T),W=F(250*m,1e3*m);let C=0,$=d?d.t-1:0,he=!1;return{get fromBrightness(){return f},get toBrightness(){return y},get t(){return $},get isDone(){return he},progress:U=>{C+=U,$=C/W,$>=1&&(he=!0)},sample:U=>f+T*U}}const h=Be(`
                                                                                                X       x
                                                                         
                                                        X
                                                
                                        
        x             x
        `),v=d=>{const x=performance.now()-d;a.clearRect(0,0,i.width,i.height);for(let y=0;y<3**2;y++){let T=_e(c,y,u);T.progress(x),T.isDone&&(T=u(T),c[y]=T)}let f=0;for(let y=1;y<4;y++)for(let T=1;T<4;T++){const m=c[f],W=m.sample(h(m.t));a.fillStyle=`hsl(0, 0%, 55%,  ${W})`,a.fillRect(T*l,y*l,l,l),f++}requestAnimationFrame(v)};n.append(i),requestAnimationFrame(v)}function Gt(n){const e=ke(["gui-container","dock-top"]),t=Ie(n,"brush","B",re(St,{invert:!0}));N(Ce(t),!0);const r=[t,Ie(n,"eraser","E",re(Pt,{invert:!0}))];return _t(r.map(Ce)),e.append(Y("reload",[Ot(n)]),Y("tools",r),Y("tile-select",[Lt()])),e}function Ft(){document.querySelector(":root").style.setProperty("--btn-press-anim-duration",Me+"ms")}function Dt(n,e){Ft();const t=[Gt(e)];n.parentElement.append(...t),Wt()}if(Object.keys(X).length!==V)throw new Error(`mismatch between configuring spritesheet size and tiles and defined mappings: ss size set to ${V} tiles, while index mappings configured for ${Object.keys(X).length} tiles`);const I=Ue(document.getElementById("canvas"),"canvas element not found");if(I.tagName!=="CANVAS")throw new Error("canvas element is not a canvas element, found: "+I.tagName);const _=I.getContext("2d");if(!_)throw new Error("2d rendering context unsupported");const zt=await le.loadDefault(),E=new Ve(I,_),oe=new Je(E,Tt(zt));let ce=!1,ue=!1,se={x:0,y:0};window.addEventListener("mousedown",()=>ce=!0);window.addEventListener("mouseup",()=>ce=!1);I.addEventListener("mousedown",()=>ue=!0);I.addEventListener("mouseup",()=>ue=!1);I.addEventListener("mousemove",n=>{se.x=n.offsetX,se.y=n.offsetY});Dt(I,{reload:n=>{E.clear()},selectTool:(n,e)=>{oe.setMode(e)},selectTileset:(n,e)=>{}});function je(){if(_.save(),_.imageSmoothingEnabled=!1,_.fillStyle="hsl(0, 0%, 15%)",_.fillRect(0,0,E.sizePixelsPadded.w,E.sizePixelsPadded.h),ce&&ue){const n=E.convertPxPositionToTilePos(se);oe.tryApplyAt(n)}E.draw(oe),_.restore(),requestAnimationFrame(je)}je();
