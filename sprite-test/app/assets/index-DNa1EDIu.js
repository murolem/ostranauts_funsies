(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();function Ye(s,e,t){let n=s[e];return n||(n=t(),s[e]=n),n}const f={none:0,left:1,up:2,right:4,down:8},he={0:f.right|f.down,1:f.left|f.down|f.right,2:f.left|f.down,3:f.up,4:f.up|f.right|f.down,5:f.left|f.up|f.right|f.down,6:f.up|f.left|f.down,7:f.right,8:f.up|f.right,9:f.left|f.up|f.right,10:f.up|f.left,11:f.left,12:f.left|f.right,13:f.none,14:f.up|f.down,15:f.down},ot=Object.entries(he).reduce((s,[e,t])=>{if(Ye(s,t,()=>parseInt(e))!=parseInt(e))throw new Error("failed to create tiling mapping: found a duplicate tiling rule: "+t.toString(2));return s},{}),Ke={left:{x:-1,y:0},up:{x:0,y:-1},right:{x:1,y:0},down:{x:0,y:1}};function lt(s,e){if(s==null)throw new Error(e);return s}function b(s){var e=document.createElement("div");return e.innerHTML=s.trim(),e.firstChild}function q(s){return b(`<div class="${s.join(" ")}"></div>`)}function at(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var se={exports:{}},Pe;function ct(){return Pe||(Pe=1,function(s){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function i(a,c,u){this.fn=a,this.context=c,this.once=u||!1}function o(a,c,u,h,v){if(typeof u!="function")throw new TypeError("The listener must be a function");var g=new i(u,h||a,v),m=t?t+c:c;return a._events[m]?a._events[m].fn?a._events[m]=[a._events[m],g]:a._events[m].push(g):(a._events[m]=g,a._eventsCount++),a}function r(a,c){--a._eventsCount===0?a._events=new n:delete a._events[c]}function l(){this._events=new n,this._eventsCount=0}l.prototype.eventNames=function(){var c=[],u,h;if(this._eventsCount===0)return c;for(h in u=this._events)e.call(u,h)&&c.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},l.prototype.listeners=function(c){var u=t?t+c:c,h=this._events[u];if(!h)return[];if(h.fn)return[h.fn];for(var v=0,g=h.length,m=new Array(g);v<g;v++)m[v]=h[v].fn;return m},l.prototype.listenerCount=function(c){var u=t?t+c:c,h=this._events[u];return h?h.fn?1:h.length:0},l.prototype.emit=function(c,u,h,v,g,m){var E=t?t+c:c;if(!this._events[E])return!1;var d=this._events[E],y=arguments.length,T,p;if(d.fn){switch(d.once&&this.removeListener(c,d.fn,void 0,!0),y){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,u),!0;case 3:return d.fn.call(d.context,u,h),!0;case 4:return d.fn.call(d.context,u,h,v),!0;case 5:return d.fn.call(d.context,u,h,v,g),!0;case 6:return d.fn.call(d.context,u,h,v,g,m),!0}for(p=1,T=new Array(y-1);p<y;p++)T[p-1]=arguments[p];d.fn.apply(d.context,T)}else{var R=d.length,L;for(p=0;p<R;p++)switch(d[p].once&&this.removeListener(c,d[p].fn,void 0,!0),y){case 1:d[p].fn.call(d[p].context);break;case 2:d[p].fn.call(d[p].context,u);break;case 3:d[p].fn.call(d[p].context,u,h);break;case 4:d[p].fn.call(d[p].context,u,h,v);break;default:if(!T)for(L=1,T=new Array(y-1);L<y;L++)T[L-1]=arguments[L];d[p].fn.apply(d[p].context,T)}}return!0},l.prototype.on=function(c,u,h){return o(this,c,u,h,!1)},l.prototype.once=function(c,u,h){return o(this,c,u,h,!0)},l.prototype.removeListener=function(c,u,h,v){var g=t?t+c:c;if(!this._events[g])return this;if(!u)return r(this,g),this;var m=this._events[g];if(m.fn)m.fn===u&&(!v||m.once)&&(!h||m.context===h)&&r(this,g);else{for(var E=0,d=[],y=m.length;E<y;E++)(m[E].fn!==u||v&&!m[E].once||h&&m[E].context!==h)&&d.push(m[E]);d.length?this._events[g]=d.length===1?d[0]:d:r(this,g)}return this},l.prototype.removeAllListeners=function(c){var u;return c?(u=t?t+c:c,this._events[u]&&r(this,u)):(this._events=new n,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=t,l.EventEmitter=l,s.exports=l}(se)),se.exports}var ut=ct();const ht=at(ut);class D{_baseEventEmitter=null;_eventName="<NO_NAME>";get eventName(){return this._eventName}opts;_persistingEmits=[];constructor(e){this.opts={persistEvents:e?.persistEvents??!1}}_setBaseEventEmitter(e){this._baseEventEmitter=e}_setEventName(e){this._eventName=e}emit(e,...t){this.assertEmitterSet(),this._baseEventEmitter.emit(this.eventName,...t),this.opts.persistEvents&&this._persistingEmits.push({source:e,data:t[0]});//! use any assertion because of the magic fuckery used for this function arguments
}on(e){this.assertEmitterSet(),this._baseEventEmitter.on(this.eventName,e),this.opts.persistEvents&&this._persistingEmits.forEach(t=>e(t.data,t.source))}off(e){this.assertEmitterSet(),this._baseEventEmitter.off(this.eventName,e)}once(e){this.assertEmitterSet(),this._baseEventEmitter.once(this.eventName,e),this.opts.persistEvents&&this._persistingEmits.length>0&&(e(this._persistingEmits[0].data,this._persistingEmits[0].source),this.off(e))}assertEmitterSet(){if(!this._baseEventEmitter)throw new Error("assertion failed assertSetEmitterSet")}}const dt=(s,e)=>{function t(n,i){for(const[o,r]of Object.entries(n)){const l=[...i,o];r instanceof D?(r._setEventName(l.join(".")),r._setBaseEventEmitter(e)):t(r,l)}}t(s,[])};function H(s){const e=new ht;return dt(s,e),s}const gt=H({notificationSpawned:new D});class ft{get element(){return this._element}_element;constructor(){this._element=q(["notification-queue"]),S.notificationQueue.set(this),document.body.append(this.element)}dispatch(e){this.element.append(e.element),gt.notificationSpawned.emit(this,{notification:e})}queueDismiss(e,t){return window.setTimeout(()=>e.element.remove(),t)}cancelQueuedDismiss(e){window.clearTimeout(e)}}const mt=[{ssName:"Core_ItmSealTemp01Sheet",relPath:"ItmSealTemp01Sheet.png"},{ssName:"Core_ItmWallBlueCaution01Sheet",relPath:"ItmWallBlueCaution01Sheet.png"},{ssName:"Core_ItmWallGrayBevel01Sheet",relPath:"ItmWallGrayBevel01Sheet.png"},{ssName:"Core_ItmWallGrayCaution01Sheet",relPath:"ItmWallGrayCaution01Sheet.png"},{ssName:"Core_ItmWallGrayPanel01Sheet",relPath:"ItmWallGrayPanel01Sheet.png"},{ssName:"Core_ItmWallGreenCross01Sheet",relPath:"ItmWallGreenCross01Sheet.png"},{ssName:"Core_ItmWallGreenRing01Sheet",relPath:"ItmWallGreenRing01Sheet.png"},{ssName:"Core_ItmWallMetalBSheet",relPath:"ItmWallMetalBSheet.png"},{ssName:"Core_ItmWallPanelWSheet",relPath:"ItmWallPanelWSheet.png"},{ssName:"Core_ItmWallPurpleCross01Sheet",relPath:"ItmWallPurpleCross01Sheet.png"},{ssName:"Core_ItmWallRedBand01Sheet",relPath:"ItmWallRedBand01Sheet.png"},{ssName:"Core_ItmWallRedCross01Sheet",relPath:"ItmWallRedCross01Sheet.png"},{ssName:"Core_ItmWallTanOrange01Sheet",relPath:"ItmWallTanOrange01Sheet.png"},{ssName:"Core_ItmWallThin1x1BlueSheet",relPath:"ItmWallThin1x1BlueSheet.png"},{ssName:"Core_ItmWallThin1x1GrayCautionSheet",relPath:"ItmWallThin1x1GrayCautionSheet.png"},{ssName:"Core_ItmWallThin1x1GrayCautionSheet02",relPath:"ItmWallThin1x1GrayCautionSheet02.png"},{ssName:"Core_ItmWallThin1x1GraySheet",relPath:"ItmWallThin1x1GraySheet.png"},{ssName:"Core_ItmWallThin1x1GreenSheet",relPath:"ItmWallThin1x1GreenSheet.png"},{ssName:"Core_ItmWallThin1x1OrangeSheet",relPath:"ItmWallThin1x1OrangeSheet.png"},{ssName:"Core_ItmWallThin1x1RedSheet",relPath:"ItmWallThin1x1RedSheet.png"},{ssName:"Core_ItmWallThin1x1YellowSheet",relPath:"ItmWallThin1x1YellowSheet.png"},{ssName:"Core_ItmWallWhiteCross01Sheet",relPath:"ItmWallWhiteCross01Sheet.png"},{ssName:"Core_ItmWallWindowSheet",relPath:"ItmWallWindowSheet.png"},{ssName:"Core_ItmWallWindowSheetSq",relPath:"ItmWallWindowSheetSq.png"},{ssName:"Core_ItmWallYellowCaution01Sheet",relPath:"ItmWallYellowCaution01Sheet.png"},{ssName:"Core_ItmWallAeroSheet",relPath:"AeroParts/ItmWallAeroSheet.png"},{ssName:"Core_ItmWallAeroSheetSq",relPath:"AeroParts/ItmWallAeroSheetSq.png"},{ssName:"Core_ItmWallAeroExtWhite01Sheet",relPath:"ItmFloorGrate12A/ItmWallAeroExtWhite01Sheet.png"},{ssName:"Core_ItmWallAeroInt01Sheet",relPath:"ItmFloorGrate12A/ItmWallAeroInt01Sheet.png"},{ssName:"Core_ItmWallAeroInt02Sheet",relPath:"ItmFloorGrate12A/ItmWallAeroInt02Sheet.png"},{ssName:"Core_ItmWallAeroInt03Sheet",relPath:"ItmFloorGrate12A/ItmWallAeroInt03Sheet.png"},{ssName:"Core_ItmWallAeroInt04Sheet",relPath:"ItmFloorGrate12A/ItmWallAeroInt04Sheet.png"},{ssName:"Core_ItmMeat01EyeSheet",relPath:"Meat01/ItmMeat01EyeSheet.png"},{ssName:"Core_ItmMeat01HoofSheet",relPath:"Meat01/ItmMeat01HoofSheet.png"},{ssName:"Core_ItmMeat01HornSheet",relPath:"Meat01/ItmMeat01HornSheet.png"},{ssName:"Core_ItmMeat01Sheet",relPath:"Meat01/ItmMeat01Sheet.png"}];async function pt(s){await new Promise(e=>setTimeout(e,s))}const ne=10,Ae=(s=0)=>e=>`\x1B[${e+s}m`,We=(s=0)=>e=>`\x1B[${38+s};5;${e}m`,Be=(s=0)=>(e,t,n)=>`\x1B[${38+s};2;${e};${t};${n}m`,w={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],gray:[90,39],grey:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgGray:[100,49],bgGrey:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};Object.keys(w.modifier);const vt=Object.keys(w.color),wt=Object.keys(w.bgColor);[...vt,...wt];function bt(){const s=new Map;for(const[e,t]of Object.entries(w)){for(const[n,i]of Object.entries(t))w[n]={open:`\x1B[${i[0]}m`,close:`\x1B[${i[1]}m`},t[n]=w[n],s.set(i[0],i[1]);Object.defineProperty(w,e,{value:t,enumerable:!1})}return Object.defineProperty(w,"codes",{value:s,enumerable:!1}),w.color.close="\x1B[39m",w.bgColor.close="\x1B[49m",w.color.ansi=Ae(),w.color.ansi256=We(),w.color.ansi16m=Be(),w.bgColor.ansi=Ae(ne),w.bgColor.ansi256=We(ne),w.bgColor.ansi16m=Be(ne),Object.defineProperties(w,{rgbToAnsi256:{value(e,t,n){return e===t&&t===n?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(t/255*5)+Math.round(n/255*5)},enumerable:!1},hexToRgb:{value(e){const t=/[a-f\d]{6}|[a-f\d]{3}/i.exec(e.toString(16));if(!t)return[0,0,0];let[n]=t;n.length===3&&(n=[...n].map(o=>o+o).join(""));const i=Number.parseInt(n,16);return[i>>16&255,i>>8&255,i&255]},enumerable:!1},hexToAnsi256:{value:e=>w.rgbToAnsi256(...w.hexToRgb(e)),enumerable:!1},ansi256ToAnsi:{value(e){if(e<8)return 30+e;if(e<16)return 90+(e-8);let t,n,i;if(e>=232)t=((e-232)*10+8)/255,n=t,i=t;else{e-=16;const l=e%36;t=Math.floor(e/36)/5,n=Math.floor(l/6)/5,i=l%6/5}const o=Math.max(t,n,i)*2;if(o===0)return 30;let r=30+(Math.round(i)<<2|Math.round(n)<<1|Math.round(t));return o===2&&(r+=60),r},enumerable:!1},rgbToAnsi:{value:(e,t,n)=>w.ansi256ToAnsi(w.rgbToAnsi256(e,t,n)),enumerable:!1},hexToAnsi:{value:e=>w.ansi256ToAnsi(w.hexToAnsi256(e)),enumerable:!1}}),w}const A=bt(),Le=(()=>{if(!("navigator"in globalThis))return 0;if(globalThis.navigator.userAgentData){const s=navigator.userAgentData.brands.find(({brand:e})=>e==="Chromium");if(s&&s.version>93)return 3}return/\b(Chrome|Chromium)\//.test(globalThis.navigator.userAgent)?1:0})(),ke=Le!==0&&{level:Le},yt={stdout:ke,stderr:ke};function Tt(s,e,t){let n=s.indexOf(e);if(n===-1)return s;const i=e.length;let o=0,r="";do r+=s.slice(o,n)+e+t,o=n+i,n=s.indexOf(e,o);while(n!==-1);return r+=s.slice(o),r}function St(s,e,t,n){let i=0,o="";do{const r=s[n-1]==="\r";o+=s.slice(i,r?n-1:n)+e+(r?`\r
`:`
`)+t,i=n+1,n=s.indexOf(`
`,i)}while(n!==-1);return o+=s.slice(i),o}const{stdout:Me,stderr:Ne}=yt,de=Symbol("GENERATOR"),G=Symbol("STYLER"),j=Symbol("IS_EMPTY"),Oe=["ansi","ansi","ansi256","ansi16m"],U=Object.create(null),_t=(s,e={})=>{if(e.level&&!(Number.isInteger(e.level)&&e.level>=0&&e.level<=3))throw new Error("The `level` option should be an integer from 0 to 3");const t=Me?Me.level:0;s.level=e.level===void 0?t:e.level},xt=s=>{const e=(...t)=>t.join(" ");return _t(e,s),Object.setPrototypeOf(e,Y.prototype),e};function Y(s){return xt(s)}Object.setPrototypeOf(Y.prototype,Function.prototype);for(const[s,e]of Object.entries(A))U[s]={get(){const t=J(this,fe(e.open,e.close,this[G]),this[j]);return Object.defineProperty(this,s,{value:t}),t}};U.visible={get(){const s=J(this,this[G],!0);return Object.defineProperty(this,"visible",{value:s}),s}};const ge=(s,e,t,...n)=>s==="rgb"?e==="ansi16m"?A[t].ansi16m(...n):e==="ansi256"?A[t].ansi256(A.rgbToAnsi256(...n)):A[t].ansi(A.rgbToAnsi(...n)):s==="hex"?ge("rgb",e,t,...A.hexToRgb(...n)):A[t][s](...n),Ct=["rgb","hex","ansi256"];for(const s of Ct){U[s]={get(){const{level:t}=this;return function(...n){const i=fe(ge(s,Oe[t],"color",...n),A.color.close,this[G]);return J(this,i,this[j])}}};const e="bg"+s[0].toUpperCase()+s.slice(1);U[e]={get(){const{level:t}=this;return function(...n){const i=fe(ge(s,Oe[t],"bgColor",...n),A.bgColor.close,this[G]);return J(this,i,this[j])}}}}const Et=Object.defineProperties(()=>{},{...U,level:{enumerable:!0,get(){return this[de].level},set(s){this[de].level=s}}}),fe=(s,e,t)=>{let n,i;return t===void 0?(n=s,i=e):(n=t.openAll+s,i=e+t.closeAll),{open:s,close:e,openAll:n,closeAll:i,parent:t}},J=(s,e,t)=>{const n=(...i)=>It(n,i.length===1?""+i[0]:i.join(" "));return Object.setPrototypeOf(n,Et),n[de]=s,n[G]=e,n[j]=t,n},It=(s,e)=>{if(s.level<=0||!e)return s[j]?"":e;let t=s[G];if(t===void 0)return e;const{openAll:n,closeAll:i}=t;if(e.includes("\x1B"))for(;t!==void 0;)e=Tt(e,t.close,t.open),t=t.parent;const o=e.indexOf(`
`);return o!==-1&&(e=St(e,i,n,o)),n+e+i};Object.defineProperties(Y.prototype,U);const F=Y();Y({level:Ne?Ne.level:0});const me={DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},Pt={DEBUG:s=>F.gray(s),INFO:s=>s,WARN:s=>F.yellow(s),ERROR:s=>F.red(s),FATAL:s=>F.bgRed(s)};let pe="INFO",De=me[pe];const At={};class Wt{logPrefix="";constructor(e){this.logPrefix=e}static setLogLevel(e){pe=e,De=me[pe]}setLogPrefix=e=>{this.logPrefix=e};log=(e,t,...n)=>{if(me[e]<De)return;const i=typeof t=="object",o=i?t.msg:t,r=i?t:At;let l;e==="DEBUG"||e==="INFO"?l=console.log:e==="WARN"?l=console.warn:e==="ERROR"||e==="FATAL"?l=console.error:l=console.log;const a=Pt[e],c=o.split(`
`);for(let u=0;u<c.length;u++)l(a(`${F.bold(e.toLowerCase())}: [${this.logPrefix}] ${c[u]}`));if(n.length>0&&l(...n),r.data!==void 0&&(r.stringifyData?l(JSON.stringify(r.data,null,4)):l(r.data)),r.throw)throw new Error("see previous message")};logDebug=(e,...t)=>{this.log("DEBUG",e,...t)};logInfo=(e,...t)=>{this.log("INFO",e,...t)};logWarn=(e,...t)=>{this.log("WARN",e,...t)};logError=(e,...t)=>{this.log("ERROR",e,...t)};logFatal=(e,...t)=>{this.log("FATAL",e,...t)}}function Bt(s,e){return e*s.y+s.x}function ve(s,e){const t=Math.floor(s/e);return{x:s-e*t,y:t}}function Q(s,e){return Array.isArray(s)?(e=s[1],s=s[0]):e===void 0&&(e=s,s=0),s+Math.random()*(e-s)}function Lt(...s){return Math.round(Q.apply(null,s))}function kt(s){return s.length>0?Lt(s.length-1):-1}function Mt(s){return s[kt(s)]}const Nt="--notif-duration-ms",Ot="--notif-removal-duration-ms",Re=150,ie="initial",Dt="no-auto-dismiss",Rt="removing";class we{get element(){return this._element}_element;get title(){return this._title}_title;get content(){return this._content}_content;get durationMs(){return this._durationMs}_durationMs;_progressElement;_queuedDismissHandle=null;constructor(e,t,n,i){if(this._title=t,this._content=n,i!==void 0)this._durationMs=i;else switch(e){case"info":this._durationMs=5e3;break;case"warning":case"error":this._durationMs=1e4;break;default:throw new Error("unsupported notif type: "+e)}this._element=q(["notification",ie,e]),this.element.style.setProperty(Nt,this._durationMs+"ms"),this.element.style.setProperty(Ot,Re+"ms"),this.element.addEventListener("mouseenter",()=>this.cancelQueuedDismiss()),this.element.addEventListener("contextmenu",o=>{o.preventDefault(),this.queueDismiss(0)}),this._progressElement=b('<div class="notification-progress initial"></div>'),this.element.append(this._progressElement,b(`<span class="notification-header">${t}</span>`),b(`<span class="notification-content">${n}</span>`))}dispatch(){S.notificationQueue.get().dispatch(this),setTimeout(()=>{this.element.classList.remove(ie),this._progressElement.classList.remove(ie)},50),this.queueDismiss()}queueDismiss(e=this.durationMs){const t=()=>{S.notificationQueue.get().queueDismiss(this,Re),this.element.classList.add(Rt),this._queuedDismissHandle=null};e===0?t():this._queuedDismissHandle=window.setTimeout(()=>t(),e)}cancelQueuedDismiss(){this._queuedDismissHandle!==null&&(window.clearTimeout(this._queuedDismissHandle),this._progressElement.classList.add(Dt),this._queuedDismissHandle=null,this._progressElement.style.setProperty("width",getComputedStyle(this._progressElement).width),this._progressElement.style.setProperty("--notif-progress-transition","none"))}}const Gt=new Wt("lib/spritesheets"),{logError:Ut,logFatal:vs}=Gt,Ge=mt,Qe=H({loaded:new D({persistEvents:!0})});class B{get name(){return this._name}set name(e){this._name=e}_name;get imageUrl(){return this._imageUrl}set imageUrl(e){this.imageUrl=e}_imageUrl;get isLoaded(){return this._isLoaded}set isLoaded(e){this._isLoaded=e}_isLoaded=!1;get image(){return this._image}_image=null;constructor(e,t){this._name=e,this._imageUrl=t}static async loadAll(e){const t=[];for(const n of e){const i=n.load();t.push(i),await pt(25)}return await Promise.all(t)}static getRandomCoreTileset(){const e=Mt(Ge),t=`${Ve}/${e.relPath}`;return new B(e.ssName,t)}static getAllCoreTilesets(){return Ge.map(e=>new B(e.ssName,`${Ve}/${e.relPath}`))}static convertCardinalNeighborsToTiling(e){let t=f.none;for(const[n,i]of Object.entries(e))i!==void 0&&(t|=f[n]);return t}isEqual(e){return this.imageUrl===e.imageUrl&&this.name===e.name}async load(){if(this.isLoaded)return console.warn(this),console.warn("attempting to load an already loaded spritesheet: (see above)"),this;const e=await fetch(this.imageUrl).then(t=>t.blob()).then(createImageBitmap).catch(t=>{new we("error","Failed to load a spritesheet",`Encountered an error while loading: ${t.toString()}`).dispatch(),Ut({msg:"error while loading a spritesheet",data:{ss:this,imageUrl:this.imageUrl,name:this.name,error:t}})});return e?e.width!==K.w||e.height!==K.h?(new we("error","Failed to load a spritesheet",`Wrong spritesheet size: expected ${K.w}x${K.h}px, got ${e.width}x${e.height}px.`).dispatch(),this):(this._image=e,this._isLoaded=!0,Qe.loaded.emit(this,{spritesheet:this,image:this.image,imageUrl:this.imageUrl}),this):this}setImageUrl(e){this._image=null,this._imageUrl=e,this._isLoaded=!1}convertSsIndexToTilePosition(e){return this.assertSsIndexWithinSpritesheet(e),ve(e,V.w)}calculateSpritesheetTileRegion(e){const t=ot[e],n=this.convertSsIndexToSsTilePosition(t);return{x:n.x*O,y:n.y*O,w:O,h:O}}convertSsIndexToSsTilePosition(e){return ve(e,V.w)}isSsIndexWithinSpritesheet(e){return e<be}assertSsIndexWithinSpritesheet(e){if(!this.isSsIndexWithinSpritesheet(e))throw new Error("failed assert assertSsIndexWithinSpritesheet: "+e)}assertLoaded(e){if(!this.isLoaded)throw new Error(e??"failed assert assertLoaded")}}const _=[];for(let s=0;s<256;++s)_.push((s+256).toString(16).slice(1));function Vt(s,e=0){return(_[s[e+0]]+_[s[e+1]]+_[s[e+2]]+_[s[e+3]]+"-"+_[s[e+4]]+_[s[e+5]]+"-"+_[s[e+6]]+_[s[e+7]]+"-"+_[s[e+8]]+_[s[e+9]]+"-"+_[s[e+10]]+_[s[e+11]]+_[s[e+12]]+_[s[e+13]]+_[s[e+14]]+_[s[e+15]]).toLowerCase()}let re;const Ft=new Uint8Array(16);function zt(){if(!re){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");re=crypto.getRandomValues.bind(crypto)}return re(Ft)}const $t=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ue={randomUUID:$t};function Xe(s,e,t){if(Ue.randomUUID&&!s)return Ue.randomUUID();s=s||{};const n=s.random??s.rng?.()??zt();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=n[6]&15|64,n[8]=n[8]&63|128,Vt(n)}class M{value;noValue;constructor(e){this.noValue=Xe(),arguments.length>0?this.value=e:this.value=this.noValue}get hasValue(){return this.value!==this.noValue}tryGet(e){return this.hasValue?(e(this.value),!0):!1}get(){if(!this.hasValue)throw new Error("store get() error: no value");return this.value}set(e){this.value=e}clear(){this.value=this.noValue}}const O=16,jt=3,V=Object.freeze({w:4,h:4}),Ve="spritesheets",be=V.w*V.h,x=O*jt,K=Object.freeze({w:V.w*O,h:V.h*O}),S={canvas:new M,grid:new M,brush:new M,tileWindow:new M,initialSpritesheet:new M,coreSpritesheets:new M,notificationQueue:new M},_e=H({gui:{gui_built__persisting:new D({persistEvents:!0})}});function qt(s,e,t){return Math.max(Math.min(s,t),e)}function Fe(s,e){for(var t=1,n=s-e+1;n<=s;n++)t*=n;for(var n=1;n<=e;n++)t/=n;return t}function Ht(s,e){var t=e.length-1,n=0,i=0;for(let o=0;o<=t;o++)i=i+Fe(t,o)*Math.pow(1-s,t-o)*Math.pow(s,o)*e[o].x,n=n+Fe(t,o)*Math.pow(1-s,t-o)*Math.pow(s,o)*e[o].y;return n}function Je(s){let e=s.split(`
`);e=e.slice(1,e.length-1);const t=e.reduce((r,l)=>l.length>r?l.length:r,0),n=1/t,i=1/e.length,o=[];for(let r=0;r<t;r++){for(const[l,a]of e.entries()){const c=a[r];if(c!==void 0&&c!==" "){const u={x:r*n,y:(e.length-l)*i};o.push(u);continue}}[...e.entries()].find(([l,a])=>{const c=a[r];return c!==void 0&&c!==" "})}return function(r){return Ht(r,o)}}function oe(s,e,t){return s>=e&&s<=t}class Yt{constructor(e,t){this._canvas=e,this._ctx=t,this._sizeTiles=Object.freeze({w:Math.floor(e.clientWidth/x),h:Math.floor(e.clientHeight/x)}),this._sizePixels=Object.freeze({w:this.sizeTiles.w*x,h:this.sizeTiles.h*x}),e.width=this._sizePixels.w,e.height=this._sizePixels.h,e.classList.add("initialized")}get sizeTiles(){return this._sizeTiles}_sizeTiles;get sizePixelsPadded(){return this._sizePixels}_sizePixels;_grid={};_scheduledClearDurationMs=150;_clearScheduleAtTs=null;_sampleClearCurve=Je(`
                                                                                        X       x
                                                                 
                                                X
                                        
                                
x             x
`);convertPxPositionToTilePos(e){return{x:Math.floor(e.x/x),y:Math.floor(e.y/x)}}convertTilePositionToTileGridIndex(e){return Bt(e,this.sizeTiles.w)}convertTileGridIndexToTilePosition(e){return ve(e,this.sizeTiles.w)}get(e){const t=typeof e=="number"?e:this.convertTilePositionToTileGridIndex(e);return this._grid[t]}getCardinalNeighbors(e){const t={left:void 0,up:void 0,right:void 0,down:void 0};for(const[n,i]of Object.entries(Ke)){const o=n,r={x:e.x+i.x,y:e.y+i.y};this.isTilePositionWithinGrid(r)&&(t[o]=this.get(r))}return t}set(e,t){const n=typeof e=="number"?e:this.convertTilePositionToTileGridIndex(e),i=t;this.assertGridIndexWithinGrid(n),i===void 0?delete this._grid[n]:this._grid[n]=i}hasAt(e){const t=typeof e=="number"?e:this.convertTilePositionToTileGridIndex(e);return this.assertGridIndexWithinGrid(t),this._grid[t]!==void 0}draw(e){this._tryScheduledClearIfAny();const t=this._ctx;t.strokeStyle="hsl(0, 0%, 20%)";for(let r=0;r<=this.sizeTiles.w;r++){const l={x:x*r,y:0},a={x:x*r,y:this.sizePixelsPadded.h};t.beginPath(),t.moveTo(l.x,l.y),t.lineTo(a.x,a.y),t.stroke()}for(let r=0;r<=this.sizeTiles.h;r++){const l={x:0,y:x*r},a={x:this.sizePixelsPadded.w,y:x*r};t.beginPath(),t.moveTo(l.x,l.y),t.lineTo(a.x,a.y),t.stroke()}const n=this._isClearScheduled();let i=0,o=0;if(n){const r=this._getScheduledClearProgress();i=this._sampleClearCurve(r),o=x/2*i}for(let[r,l]of Object.entries(this._grid)){if(l===void 0||l.ss.image===null)continue;const a=parseInt(r),c=this.convertTileGridIndexToTilePosition(a),u={x:c.x*x,y:c.y*x},h=l.ss.calculateSpritesheetTileRegion(l.tiling);t.save(),t.translate(u.x,u.y),n&&(t.translate(o,o),t.scale(1-i,1-i)),t.drawImage(l.ss.image,h.x,h.y,h.w,h.h,0,0,x,x),t.restore()}}clear(){this._isClearScheduled()||(this._clearScheduleAtTs=Date.now()+this._scheduledClearDurationMs)}_tryScheduledClearIfAny(){this._isClearScheduled()&&this._clearScheduleAtTs<=Date.now()&&(this._grid={},this._clearScheduleAtTs=null)}_getScheduledClearProgress(){if(!this._isClearScheduled())return 0;const t=1-(this._clearScheduleAtTs-Date.now())/this._scheduledClearDurationMs;return qt(t,0,1)}_isClearScheduled(){return this._clearScheduleAtTs!==null}isTilePositionWithinGrid(e){return oe(e.x,0,this.sizeTiles.w-1)&&oe(e.y,0,this.sizeTiles.h-1)}isGridIndexWithinGrid(e){return oe(e,0,this.sizeTiles.w*this.sizeTiles.h)}assertTilePositionWithinGrid(e){if(!this.isTilePositionWithinGrid(e))throw new Error("failed assert assertIsTilePositionWithinGrid: "+e)}assertGridIndexWithinGrid(e){if(!this.isGridIndexWithinGrid(e))throw new Error("failed assert assertGridIndexWithinGrid: "+e)}}const Ze=H({tilesetChanged:new D});class Kt{get tileset(){return this._tileset}_tileset;grid=S.grid.get();mode="brush";constructor(e){this._tileset=e}setTileset(e){const t=this.tileset;this._tileset=e,Ze.tilesetChanged.emit(this,{oldTileset:t,newTileset:e})}setMode(e){this.mode=e}tryApplyAt(e){if(!this.grid.isTilePositionWithinGrid(e))return;const t=this.grid.getCardinalNeighbors(e);switch(this.mode){case"brush":if(!this._tileset.isLoaded)return;this.applyBrushMode(e,t);break;case"eraser":this.applyEraserMode(e);break;default:throw new Error("not impl brush mode: "+this.mode)}for(const[n,i]of Object.entries(t)){const o=n;if(i===void 0)continue;const r=Ke[o],l={x:e.x+r.x,y:e.y+r.y},a=this.grid.getCardinalNeighbors(l),c=B.convertCardinalNeighborsToTiling(a);this.grid.set(l,{ss:i.ss,tiling:c})}}applyBrushMode(e,t){const n=B.convertCardinalNeighborsToTiling(t);this.grid.set(e,{ss:this.tileset,tiling:n})}applyEraserMode(e){this.grid.hasAt(e)&&this.grid.set(e,void 0)}}const ze="active",et=125,X={h:25,s:99,l:57};function Qt(){return b('<button class="simple-button"></button>')}function ye(s,{invert:e=!1}={}){return b(`<img src="${s}" class="icon${e?" invert":""}">`)}const Xt="https://murolem.github.io/ostranauts_funsies/sprite-test/app/assets/trash-bin-black-Bnsn3vaF.png",Jt="https://murolem.github.io/ostranauts_funsies/sprite-test/app/assets/paint-brush-black-DGHBLeNn.png",Zt="https://murolem.github.io/ostranauts_funsies/sprite-test/app/assets/eraser-black-DRmb9ui2.png";function le(s,e){const t=q(["button-section",`name-${s}`]);return t.classList.add(),t.append(...e),t}const ae="toggled",W=H({toggle:new D,exclusiveSelectionBindCreated:new D});class C{constructor(e,t){this.element=e,this.options={toggleOnClick:t?.toggleOnClick??!1},this.options.toggleOnClick&&e.addEventListener("click",()=>this.invertToggle(this))}options;static with(e,t){return new C(e,t)}static attach(e,t){return new C(e,t)}static bindTogglablesToExclusiveToggleOnState(e,{keepOneToggled:t=!1,toggleOn:n=null}={}){if(e.length===0)return;const i=Xe(),o=e[0]instanceof HTMLElement?new Set(e):new Set(e.map(c=>c.element));let r=null;const l=c=>{if(o.has(c.element))if(c.toggleState){if(c.element===r)return;const u=r;r=c.element,u&&C.with(u).toggleOff(c.causedBy)}else{if(c.element!==r)return;if(t){C.with(c.element).toggleOn("e.causedBy");return}r=c.element}},a=c=>{c.bindingId!==i&&[...c.boundElements].some(u=>o.has(u))&&(W.toggle.off(l),W.exclusiveSelectionBindCreated.off(a),r&&C.with(r).toggleOff("binding override"))};W.toggle.on(l),W.exclusiveSelectionBindCreated.on(a),W.exclusiveSelectionBindCreated.emit(o,{bindingId:i,boundElements:o}),n&&(n instanceof HTMLElement&&(n=C.with(n)),n.toggleOn(this))}get toggleState(){return this.element.classList.contains(ae)}isEqual(e){return this.element===e.element}invertToggle(e){this.toggleTo(!this.toggleState,e)}toggleTo(e,t){this.toggleState!==e&&(e?this.element.classList.add(ae):this.element.classList.remove(ae),W.toggle.emit(t,{element:this.element,togglable:this,toggleState:e,causedBy:t}))}toggleOn(e){this.toggleTo(!0,e)}toggleOff(e){this.toggleTo(!1,e)}bindAutosyncWith(e){W.toggle.on(t=>{t.element===this.element&&t.causedBy!==e.element?e.toggleTo(t.toggleState,t.element):t.element===e.element&&t.causedBy!==this.element&&this.toggleTo(t.toggleState,t.element)})}}function $(s,e){const t=b(`<button class="toggle-button ${s?s.join(" "):""}"></button>`);e!==void 0&&t.append(e);const n=C.attach(t,{toggleOnClick:!0});return[t,n]}function es(s,e,t){const n=b('<label class="button-label-wrapping"></label>'),i=b(`<span class="button-label-text">${e}</span>`);return n.append(s),n.append(i),n}const ts={Tab:9,Clear:12,Shift:16,Control:17,AltGraph:18,Alt:18,CapsLock:20,Escape:27,PageUp:33,PageDown:34,End:35,Home:36,ArrowLeft:37,ArrowUp:38,ArrowRight:39,ArrowDown:40,Insert:45,Delete:46,0:48,"=":48,1:49,"!":49,2:50,'"':50,3:51,"§":51,4:52,$:52,5:53,"%":53,6:54,"&":54,7:55,"/":55,8:56,"(":56,9:57,")":57,a:65,A:65,b:66,B:66,c:67,C:67,d:68,D:68,e:69,E:69,f:70,F:70,g:71,G:71,h:72,H:72,i:73,I:73,j:74,J:74,k:75,K:75,l:76,L:76,m:77,M:77,n:78,N:78,o:79,O:79,p:80,P:80,Q:81,r:82,R:82,s:83,S:83,t:84,T:84,u:85,U:85,v:86,V:86,w:87,W:87,x:88,X:88,y:89,Y:89,z:90,Z:90,Meta:92,F1:112,F2:113,Ü:186,"+":187,"*":187,",":188,";":188,"-":189,_:189,".":190,":":190,"#":191,"'":191,Ö:192,"?":219,"°":220,Ä:222},tt=[],Z=[];function ss(s){return ts[s]}window.addEventListener("keyup",s=>{const e=Z.findIndex(t=>t.keyCode===s.keyCode);e!==-1&&Z.splice(e,1)});window.addEventListener("keydown",s=>{Z.findIndex(n=>n.keyCode===s.keyCode)===-1&&Z.push({key:s.key,keyCode:s.keyCode});const t=tt.find(n=>n.keyCodes.includes(s.keyCode));t&&t.action([s.key],[s.keyCode])});function ns(s,e){tt.push({keys:[s],keyCodes:[s].map(ss),action:e})}function xe(s,e,{setActiveForClickDuration:t=!1}={}){return ns(e,()=>{s.click(),t&&(s.classList.add(ze),setTimeout(()=>s.classList.remove(ze),et))}),es(s,e)}function ce(s){if(s.tagName==="BUTTON")return s;if(s.tagName==="LABEL")return s.querySelector(":scope > button");throw console.error(s),new Error("failed to unwrap a button: unknown configuration (see above)")}function is(s,e,t,n,i){return n+(s-e)*((i-n)/(t-e))}function st(s){const e=getComputedStyle(s);return{w:s.clientWidth+parseFloat(e.paddingLeft)+parseFloat(e.paddingRight),h:s.clientHeight+parseFloat(e.paddingTop)+parseFloat(e.paddingBottom)}}function rs(){const s=Qt();return s.appendChild(ye(Xt,{invert:!0})),s.addEventListener("click",()=>S.grid.get().clear()),xe(s,"A",{setActiveForClickDuration:!0})}function $e(s,e,t){const[n]=$(["tool-"+s]);return n.appendChild(t),W.toggle.on(i=>{i.element===n&&i.toggleState&&S.brush.get().setMode(s)}),xe(n,e)}function os(){const[s,e]=$(["button-tile"]);return e.bindAutosyncWith(S.tileWindow.get().togglable),_e.gui.gui_built__persisting.on(()=>{ls(s)}),xe(s,"T")}function ls(s){const i=document.createElement("canvas"),o=st(s),r=Math.floor(Math.min(o.w,o.h)/5);i.width=r*5,i.height=r*5;const l=i.getContext("2d");let a=!1;W.toggle.on(g=>{g.element===s&&(a=g.toggleState)});const c={};function u(g){const d=g?g.toBrightness:Q(0,1),y=Q(0,1),T=y-d,p=Math.abs(T),R=Q(250*p,1e3*p);let L=0,ee=g?g.t-1:0,Ie=!1;return{get fromBrightness(){return d},get toBrightness(){return y},get t(){return ee},get isDone(){return Ie},progress:te=>{L+=te,ee=L/R,ee>=1&&(Ie=!0)},sample:te=>d+T*te}}const h=Je(`
                                                                                                X       x
                                                                         
                                                        X
                                                
                                        
        x             x
`),v=g=>{const E=performance.now()-g;l.clearRect(0,0,i.width,i.height);for(let y=0;y<3**2;y++){let T=Ye(c,y,u);T.progress(E),T.isDone&&(T=u(T),c[y]=T)}let d=0;for(let y=1;y<4;y++)for(let T=1;T<4;T++){const p=c[d],R=p.sample(h(p.t));l.fillStyle=a?`hsl(${X.h}, ${X.s}%, ${X.l*is(R,0,1,.4,1)}%)`:`hsl(0, 0%, 55%,  ${R})`,l.fillRect(T*r,y*r,r,r),d++}requestAnimationFrame(v)};s.append(i),requestAnimationFrame(v)}function as(){const s=b('<img draggable="false" class="tile-screen">');return s.src=S.initialSpritesheet.get().imageUrl,Ze.tilesetChanged.on(e=>{s.src=e.newTileset.imageUrl}),s.addEventListener("click",()=>{S.tileWindow.get().togglable.invertToggle(s)}),s}function cs(){const s=q(["gui-container","dock-top"]),e=$e("brush","B",ye(Jt,{invert:!0})),t=$e("eraser","E",ye(Zt,{invert:!0}));return C.bindTogglablesToExclusiveToggleOnState([ce(e),ce(t)],{keepOneToggled:!0,toggleOn:ce(e)}),s.append(le("reload",[rs()]),le("tools",[e,t]),le("tile-select",[os(),as()])),s}let ue=null;function je(s,e){ue||(ue=document.querySelector(":root")),ue.style.setProperty(s,e)}function P(s){if(typeof s!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(s))}function qe(s,e){for(var t="",n=0,i=-1,o=0,r,l=0;l<=s.length;++l){if(l<s.length)r=s.charCodeAt(l);else{if(r===47)break;r=47}if(r===47){if(!(i===l-1||o===1))if(i!==l-1&&o===2){if(t.length<2||n!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){var a=t.lastIndexOf("/");if(a!==t.length-1){a===-1?(t="",n=0):(t=t.slice(0,a),n=t.length-1-t.lastIndexOf("/")),i=l,o=0;continue}}else if(t.length===2||t.length===1){t="",n=0,i=l,o=0;continue}}e&&(t.length>0?t+="/..":t="..",n=2)}else t.length>0?t+="/"+s.slice(i+1,l):t=s.slice(i+1,l),n=l-i-1;i=l,o=0}else r===46&&o!==-1?++o:o=-1}return t}function us(s,e){var t=e.dir||e.root,n=e.base||(e.name||"")+(e.ext||"");return t?t===e.root?t+n:t+s+n:n}var I={process_cwd:"",setCWD:function(e){I.process_cwd=e},resolve:function(){for(var e="",t=!1,n,i=arguments.length-1;i>=-1&&!t;i--){var o;i>=0?o=arguments[i]:(n===void 0&&(n=I.process_cwd),o=n),P(o),o.length!==0&&o+"/"!==e&&(e=o+"/"+e,t=o.charCodeAt(0)===47)}return e=qe(e,!t),t?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(P(e),e.length===0)return".";var t=e.charCodeAt(0)===47,n=e.charCodeAt(e.length-1)===47;return e=qe(e,!t),e.length===0&&!t&&(e="."),e.length>0&&n&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return P(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,t=0;t<arguments.length;++t){var n=arguments[t];P(n),n.length>0&&(e===void 0?e=n:e+="/"+n)}return e===void 0?".":I.normalize(e)},relative:function(e,t){if(P(e),P(t),e===t)return"";const n=e.replaceAll("\\","/"),i=t.replaceAll("\\","/");if(n!=e&&i!=t)return I.relative(n,i).replaceAll("/","\\");if(n!=e)return I.relative(n,t).replaceAll("/","\\");if(i!=t)return I.relative(e,i);if(e=I.resolve(e),t=I.resolve(t),e===t)return"";for(var o=1;o<e.length&&e.charCodeAt(o)===47;++o);for(var r=e.length,l=r-o,a=1;a<t.length&&t.charCodeAt(a)===47;++a);for(var c=t.length,u=c-a,h=l<u?l:u,v=-1,g=0;g<=h;++g){if(g===h){if(u>h){if(t.charCodeAt(a+g)===47)return t.slice(a+g+1);if(g===0)return t.slice(a+g)}else l>h&&(e.charCodeAt(o+g)===47?v=g:g===0&&(v=0));break}var m=e.charCodeAt(o+g),E=t.charCodeAt(a+g);if(m!==E)break;m===47&&(v=g)}var d="";for(g=o+v+1;g<=r;++g)(g===r||e.charCodeAt(g)===47)&&(d.length===0?d+="..":d+="/..");return d.length>0?d+t.slice(a+v):(a+=v,t.charCodeAt(a)===47&&++a,t.slice(a))},_makeLong:function(e){return e},dirname:function(e){if(P(e),e.length===0)return".";for(var t=e.charCodeAt(0),n=t===47,i=-1,o=!0,r=e.length-1;r>=1;--r)if(t=e.charCodeAt(r),t===47){if(!o){i=r;break}}else o=!1;return i===-1?n?"/":".":n&&i===1?"//":e.slice(0,i)},basename:function(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');P(e);var n=0,i=-1,o=!0,r;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var l=t.length-1,a=-1;for(r=e.length-1;r>=0;--r){var c=e.charCodeAt(r);if(c===47){if(!o){n=r+1;break}}else a===-1&&(o=!1,a=r+1),l>=0&&(c===t.charCodeAt(l)?--l===-1&&(i=r):(l=-1,i=a))}return n===i?i=a:i===-1&&(i=e.length),e.slice(n,i)}else{for(r=e.length-1;r>=0;--r)if(e.charCodeAt(r)===47){if(!o){n=r+1;break}}else i===-1&&(o=!1,i=r+1);return i===-1?"":e.slice(n,i)}},extname:function(e){P(e);for(var t=-1,n=0,i=-1,o=!0,r=0,l=e.length-1;l>=0;--l){var a=e.charCodeAt(l);if(a===47){if(!o){n=l+1;break}continue}i===-1&&(o=!1,i=l+1),a===46?t===-1?t=l:r!==1&&(r=1):t!==-1&&(r=-1)}return t===-1||i===-1||r===0||r===1&&t===i-1&&t===n+1?"":e.slice(t,i)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return us("/",e)},parse:function(e){P(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;var n=e.charCodeAt(0),i=n===47,o;i?(t.root="/",o=1):o=0;for(var r=-1,l=0,a=-1,c=!0,u=e.length-1,h=0;u>=o;--u){if(n=e.charCodeAt(u),n===47){if(!c){l=u+1;break}continue}a===-1&&(c=!1,a=u+1),n===46?r===-1?r=u:h!==1&&(h=1):r!==-1&&(h=-1)}return r===-1||a===-1||h===0||h===1&&r===a-1&&r===l+1?a!==-1&&(l===0&&i?t.base=t.name=e.slice(1,a):t.base=t.name=e.slice(l,a)):(l===0&&i?(t.name=e.slice(1,r),t.base=e.slice(1,a)):(t.name=e.slice(l,r),t.base=e.slice(l,a)),t.ext=e.slice(r,a)),l>0?t.dir=e.slice(0,l-1):i&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};I.posix=I;const He="placeholder",hs="--tsw-exp-calculated-width";class ds{_element;get element(){return this._element}set element(e){this._element=e}_togglable;get togglable(){return this._togglable}set togglable(e){this._togglable=e}_explorer;_activeView="core";_tilesetsByViews={all:[],core:[],user:[]};_viewToViewButtonMap={all:null,core:null,user:null};constructor(){S.tileWindow.set(this);const e=q(["tile-selection-window"]);this._element=e;const t=new C(e);this._togglable=t;const n=b('<div class="header"></div>'),i=b('<span class="header-text">TILE SELECTION</span>'),o=b('<button class="close-button no-make-style"></button>');for(let u=0;u<3;u++)o.append(b('<span class="chevron"></span>'));o.addEventListener("click",()=>{t.toggleOff(o)}),n.append(i,o);const r=b('<div class="sidebar"></div>'),l=b('<div class="sidebar-folders"></div>');l.append(...this.makeViewButtons());const a=b('<div class="sidebar-upload"></div>');a.append(this.makeUploadButton()),r.append(l,a);const c=b('<div class="explorer"></div>');this._explorer=c,this.populateViewGroup("core",S.coreSpritesheets.get()),this.selectExplorerView("core"),_e.gui.gui_built__persisting.on(()=>{const u=st(c);document.querySelector(":root").style.setProperty(hs,u.w+"px")}),e.append(n,r,c)}isOpen(){return C.with(this.element).toggleState}selectTileset(e,t,{scrollTo:n=!1}={}){S.brush.get().setTileset(e),!(!t&&(t=this.findTilesetPairUsingTileset(e)?.element??null,!t))&&(C.with(t).toggleOn(t),n&&this.isTilesetCardInCurrentView(t)&&this.scrollTo(t))}populateViewGroup(e,t,n=!1){n&&this.clearViewGroup(e);for(const i of t)this._tilesetsByViews[e].push({tileset:i,element:this.makeTilesetCard(i)});e===this._activeView&&this.selectExplorerView(e),C.bindTogglablesToExclusiveToggleOnState(this.getAllViewsTilesets().map(i=>i.element),{keepOneToggled:!0})}clearViewGroup(e){this._tilesetsByViews[e].length=0,this._activeView===e&&this.clearExplorerView()}selectExplorerView(e){this.clearExplorerView(),this._activeView=e,e==="all"?this._explorer.append(...this.getAllViewsTilesets().map(t=>t.element)):this._explorer.append(...this._tilesetsByViews[this._activeView].map(t=>t.element)),C.with(this._viewToViewButtonMap[this._activeView]).toggleOn(this)}clearExplorerView(){this._explorer.innerHTML=""}getAllViewsTilesets(){return Object.values(this._tilesetsByViews).flat()}makeTilesetCard(e){const t=b('<label class="tileset-label-wrapping"></label>'),n=b(`<img draggable="false" class="tileset" src="${e.imageUrl}">`);return e.isLoaded&&n.classList.add(He),Qe.loaded.on(i=>{i.spritesheet.isEqual(e)&&(n.classList.remove(He),n.src=i.imageUrl)}),n.addEventListener("click",()=>this.selectTileset(e,t)),t.append(n,b(`<span class="label">${e.name}</span>`)),t}makeViewButtons(){const[e]=$(["folder","no-make-style"],"all"),[t]=$(["folder","no-make-style"],"core"),[n]=$(["folder","no-make-style"],"my uploads"),i=[e,t,n];C.bindTogglablesToExclusiveToggleOnState(i,{keepOneToggled:!0}),t.click(),this._viewToViewButtonMap={all:e,core:t,user:n};for(const[o,r]of Object.entries(this._viewToViewButtonMap)){const l=o;W.toggle.on(({toggleState:a,element:c})=>{c===r&&a&&this.selectExplorerView(l)})}return i}makeUploadButton(){const e=b('<input type="file" accept="image/png" multiple>'),t=b("<label></label>");return t.append(e),t.append(b('<span><span class="bracket">&gt;</span> UPLOAD <span class="bracket">&lt;</span>')),e.addEventListener("change",async n=>{if(!e.files)return;this.selectExplorerView("user");let i=!1;for(const o of e.files){const r=await this.uploadTilesetFromDisk(o);if(r)switch(r.status){case"CREATED":i||(this.selectTileset(r.ss,null,{scrollTo:!0}),i=!0);break;case"MODIFIED":i||(this.selectTileset(r.ss,null,{scrollTo:!0}),i=!0);break;case"UNMODIFIED":i||(this.selectTileset(r.ss,null,{scrollTo:!0}),i=!0);break}}}),t}async uploadTilesetFromDisk(e){const t=new FileReader;t.readAsDataURL(e);const n=await new Promise((l,a)=>{t.addEventListener("load",()=>l(t.result)),t.addEventListener("abort",c=>a(c)),t.addEventListener("error",c=>a(c))});if(typeof n!="string")return new we("error","Failed to upload a spritesheet",`Unexpected file data type '${typeof n}' for file '${e.name}'`).dispatch(),console.error(n),null;const i=new B(I.parse(e.name).name,n),o=this.getAllViewsTilesets().find(l=>l.tileset.name===i.name)?.tileset;if(o)return o.setImageUrl(i.imageUrl),await o.load(),o.isLoaded?{status:"MODIFIED",ss:o}:null;const r=this.getAllViewsTilesets().find(l=>l.tileset.name===i.name)?.tileset;return r?{status:"UNMODIFIED",ss:r}:(await i.load(),i.isLoaded?(this.populateViewGroup("user",[i]),{status:"CREATED",ss:i}):null)}scrollTo(e){this.isTilesetCardInCurrentView(e)&&(this._explorer.scrollTop=e.offsetTop+e.offsetHeight/2-this._explorer.clientHeight/2)}findTilesetPairUsingTileset(e){return this.getAllViewsTilesets().find(n=>n.tileset.isEqual(e))??null}isTilesetCardInCurrentView(e){return!!this._tilesetsByViews[this._activeView].find(n=>n.element===e)}}function gs(){je("--btn-press-anim-duration",et+"ms");let s=X;je("--toggle-col",`hsl(${s.h}, ${s.s}%, ${s.l}%)`)}function fs(){gs();const s=new ds;document.body.append(s.element),s.selectTileset(S.initialSpritesheet.get(),null,{scrollTo:!0});const e=[cs()];S.canvas.get().parentElement.append(...e),_e.gui.gui_built__persisting.emit("gui")}if(Object.keys(he).length!==be)throw new Error(`mismatch between configuring spritesheet size and tiles and defined mappings: ss size set to ${be} tiles, while index mappings configured for ${Object.keys(he).length} tiles`);const k=lt(document.getElementById("canvas"),"canvas element not found");if(k.tagName!=="CANVAS")throw new Error("canvas element is not a canvas element, found: "+k.tagName);S.canvas.set(k);const N=k.getContext("2d");if(!N)throw new Error("2d rendering context unsupported");new ft;const nt=await B.getRandomCoreTileset().load();S.initialSpritesheet.set(nt);const it=B.getAllCoreTilesets();S.coreSpritesheets.set(it);B.loadAll(it);const z=new Yt(k,N);S.grid.set(z);const Te=new Kt(nt);S.brush.set(Te);let Ce=!1,Ee=!1,Se={x:0,y:0};window.addEventListener("mousedown",()=>Ce=!0);window.addEventListener("mouseup",()=>Ce=!1);k.addEventListener("mousedown",()=>Ee=!0);k.addEventListener("mouseup",()=>Ee=!1);k.addEventListener("mousemove",s=>{Se.x=s.offsetX,Se.y=s.offsetY});fs();function rt(){if(N.save(),N.imageSmoothingEnabled=!1,N.fillStyle="hsl(0, 0%, 15%)",N.fillRect(0,0,z.sizePixelsPadded.w,z.sizePixelsPadded.h),Ce&&Ee){const s=z.convertPxPositionToTilePos(Se);Te.tryApplyAt(s)}z.draw(Te),N.restore(),requestAnimationFrame(rt)}rt();
